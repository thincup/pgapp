window.OpenSeadragon=window.OpenSeadragon||function(e){return new OpenSeadragon.Viewer(e)},function(e){e.version={versionStr:"1.2.1",major:parseInt("1",10),minor:parseInt("2",10),revision:parseInt("1",10)};var t={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null===e||void 0===e?String(e):t[i.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!n.call(t,"constructor")&&!n.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(i in t);return void 0===i||n.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.supportsCanvas=function(){var t=document.createElement("canvas");return!(!e.isFunction(t.getContext)||!t.getContext("2d"))}()}(OpenSeadragon),function(e){function t(e,t){return t&&e!=document.body?document.body:e.offsetParent}e.extend=function(){var e,t,i,n,o,r,s=arguments[0]||{},a=arguments.length,l=!1,c=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},c=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===c&&(s=this,--c);a>c;c++)if(e=arguments[c],null!==e||void 0!==e)for(t in e)i=s[t],n=e[t],s!==n&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(o=OpenSeadragon.isArray(n)))?(o?(o=!1,r=i&&OpenSeadragon.isArray(i)?i:[]):r=i&&OpenSeadragon.isPlainObject(i)?i:{},s[t]=OpenSeadragon.extend(l,r,n)):void 0!==n&&(s[t]=n));return s},e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,pixelsPerWheelLine:40,autoResize:!0,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorRotate:!0,degrees:0,opacity:1,layersAspectRatioEpsilon:1e-4,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(i){var n,o,r=new e.Point;for(i=e.getElement(i),n="fixed"==e.getElementStyle(i).position,o=t(i,n);o;)r.x+=i.offsetLeft,r.y+=i.offsetTop,n&&(r=r.plus(e.getPageScroll())),i=o,n="fixed"==e.getElementStyle(i).position,o=t(i,n);return r},getElementOffset:function(t){t=e.getElement(t);var i,n,o=t&&t.ownerDocument,r={top:0,left:0};return o?(i=o.documentElement,"undefined"!=typeof t.getBoundingClientRect&&(r=t.getBoundingClientRect()),n=o==o.window?o:9===o.nodeType?o.defaultView||o.parentWindow:!1,new e.Point(r.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0),r.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0))):new e.Point},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return t=e.getElement(t),t.currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},pointInElement:function(t,i){t=e.getElement(t);var n=e.getElementOffset(t),o=e.getElementSize(t);return i.x>=n.x&&i.x<n.x+o.x&&i.y<n.y+o.y&&i.y>=n.y},getEvent:function(t){return e.getEvent=t?function(e){return e}:function(){return window.event},e.getEvent(t)},getMousePosition:function(t){if("number"==typeof t.pageX)e.getMousePosition=function(t){var i=new e.Point;return t=e.getEvent(t),i.x=t.pageX,i.y=t.pageY,i};else{if("number"!=typeof t.clientX)throw new Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(t){var i=new e.Point;return t=e.getEvent(t),i.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.pageXOffset)e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(i.scrollLeft||i.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!t.scrollLeft&&!t.scrollTop)return new e.Point(0,0);e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return e.getPageScroll()},setPageScroll:function(t){if("undefined"!=typeof window.scrollTo)e.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var i=e.getPageScroll();if(i.x===t.x&&i.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var n=e.getPageScroll();if(n.x!==i.x&&n.y!==i.y)return void(e.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,n=e.getPageScroll(),n.x!==i.x&&n.y!==i.y)return void(e.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});e.setPageScroll=function(){}}return e.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!i.clientWidth&&!i.clientHeight)throw new Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(t){t=e.getElement(t);var i=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(i[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(i[1].style,{display:"table-row"}),e.extend(i[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),i[0].appendChild(i[1]),i[1].appendChild(i[2]),i[2].appendChild(t),i[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return e.now=Date.now?Date.now:function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(t){return e.makeTransparentImage=function(t){var i=e.makeNeutralElement("img");return i.src=t,i},e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<7&&(e.makeTransparentImage=function(t){var i=e.makeNeutralElement("img"),n=null;return n=e.makeNeutralElement("span"),n.style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=t,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t+"', sizingMethod='scale')",n}),e.makeTransparentImage(t)},setElementOpacity:function(t,i,n){var o,r;t=e.getElement(t),n&&!e.Browser.alpha&&(i=Math.round(i)),e.Browser.opacity?t.style.opacity=1>i?i:"":1>i?(o=Math.round(100*i),r="alpha(opacity="+o+")",t.style.filter=r):t.style.filter=""},setElementTouchActionNone:function(t){t=e.getElement(t),"undefined"!=typeof t.style.touchAction?t.style.touchAction="none":"undefined"!=typeof t.style.msTouchAction&&(t.style.msTouchAction="none")},addClass:function(t,i){t=e.getElement(t),t.className?-1===(" "+t.className+" ").indexOf(" "+i+" ")&&(t.className+=" "+i):t.className=i},indexOf:function(e,t,i){return this.indexOf=Array.prototype.indexOf?function(e,t,i){return e.indexOf(t,i)}:function(e,t,i){var n,o,r=i?i:0;if(!e)throw new TypeError;if(o=e.length,0===o||r>=o)return-1;for(0>r&&(r=o-Math.abs(r)),n=r;o>n;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(t,i){var n,o,r=[];for(t=e.getElement(t),n=t.className.split(/\s+/),o=0;o<n.length;o++)n[o]&&n[o]!==i&&r.push(n[o]);t.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(t,i,n,o){t=e.getElement(t),t.addEventListener(i,n,o)};if(window.attachEvent)return function(t,i,n){t=e.getElement(t),t.attachEvent("on"+i,n)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(t,i,n,o){t=e.getElement(t),t.removeEventListener(i,n,o)};if(window.detachEvent)return function(t,i,n){t=e.getElement(t),t.detachEvent("on"+i,n)};throw new Error("No known event model.")}(),cancelEvent:function(t){t=e.getEvent(t),e.cancelEvent=t.preventDefault?function(e){e.preventDefault()}:function(t){t=e.getEvent(t),t.cancel=!0,t.returnValue=!1},e.cancelEvent(t)},stopEvent:function(t){t=e.getEvent(t),e.stopEvent=t.stopPropagation?function(e){e.stopPropagation()}:function(t){t=e.getEvent(t),t.cancelBubble=!0},e.stopEvent(t)},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,o=n.concat([]);for(i=0;i<arguments.length;i++)o.push(arguments[i]);return t.apply(e,o)}},getUrlParameter:function(e){var t=n[e];return t?t:null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(t){var i;try{i=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(n){i=!1}if(i)e.createAjaxRequest=window.XMLHttpRequest?function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");e.createAjaxRequest=function(){return new XMLHttpRequest}}return e.createAjaxRequest(t)},makeAjaxRequest:function(t,i,n){var o=e.getUrlProtocol(t),r=e.createAjaxRequest("file:"===o);if(!e.isFunction(i))throw new Error("makeAjaxRequest requires a success callback");r.onreadystatechange=function(){if(4==r.readyState){r.onreadystatechange=function(){};var s="http:"===o||"https:"===o?200:0;r.status===s?i(r):(e.console.log("AJAX request returned %d: %s",r.status,t),e.isFunction(n)&&n(r))}};try{r.open("GET",t,!0),r.send(null)}catch(s){var a=s.message,l=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<10;l&&"undefined"!=typeof s.number&&-2147024891==s.number&&(a+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),e.console.log("%s while making AJAX request: %s",s.name,a),r.onreadystatechange=function(){},e.isFunction(n)&&n(r,s)}},jsonp:function(t){var i,n=t.url,o=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+e.now(),s=window[r],a="$1"+r+"$2",l=t.param||"callback",c=t.callback;n=n.replace(/(\=)\?(&|$)|\?\?/i,a),n+=(/\?/.test(n)?"&":"?")+l+"="+r,window[r]=function(t){if(s)window[r]=s;else try{delete window[r]}catch(i){}c&&e.isFunction(c)&&c(t)},i=document.createElement("script"),(void 0!==t.async||!1!==t.async)&&(i.async="async"),t.scriptCharset&&(i.charset=t.scriptCharset),i.src=n,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,o&&i.parentNode&&o.removeChild(i),i=void 0)},o.insertBefore(i,o.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)e.parseXml=function(e){var t,i=null;return t=new DOMParser,i=t.parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");e.parseXml=function(e){var t=null;return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t}}return e.parseXml(t)},imageFormatSupported:function(e){return e=e?e:"",!!i[e.toLowerCase()]}}),e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var i={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},n={};!function(){var t,i=(navigator.appName,navigator.appVersion),o=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(o.substring(o.indexOf("MSIE")+5,o.indexOf(";",o.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(o.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(o.substring(o.indexOf("Firefox")+8))):o.indexOf("Safari")>=0?(e.Browser.vendor=o.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(o.substring(o.substring(0,o.indexOf("Safari")).lastIndexOf("/")+1,o.indexOf("Safari")))):(t=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==t.exec(o)&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(i)}var r,s,a,l=window.location.search.substring(1),c=l.split("&");for(a=0;a<c.length;a++)r=c[a],s=r.indexOf("="),s>0&&(n[r.substring(0,s)]=decodeURIComponent(r.substring(s+1)));e.Browser.alpha=!(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9||e.Browser.vendor==e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!(e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version<9)}();var o=function(){};e.console=window.console||{log:o,debug:o,info:o,warn:o,error:o},function(t){var i=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,n=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(i&&n)e.requestAnimationFrame=function(){return i.apply(t,arguments)},e.cancelAnimationFrame=function(){return n.apply(t,arguments)};else{var o,r=[],s=[],a=0;e.requestAnimationFrame=function(t){return r.push([++a,t]),o||(o=setInterval(function(){if(r.length){var t=e.now(),i=s;for(s=r,r=i;s.length;)s.shift()[1](t)}else clearInterval(o),o=void 0},20)),a},e.cancelAnimationFrame=function(e){var t,i;for(t=0,i=r.length;i>t;t+=1)if(r[t][0]===e)return void r.splice(t,1);for(t=0,i=s.length;i>t;t+=1)if(s[t][0]===e)return void s.splice(t,1)}}}(window),e._processDZIError=function(e){var t=e.getElementsByTagName("Message")[0],i=t.firstChild.nodeValue;throw new Error(i)}}(OpenSeadragon),function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(e){return e.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addHandler:function(t,i,n){var o=this.events[t];o||(this.events[t]=o=[]),i&&e.isFunction(i)&&(o[o.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,o=this.events[t],r=[];if(o&&e.isArray(o)){for(n=0;n<o.length;n++)o[n].handler!==i&&r.push(o[n]);this.events[t]=r}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,o=t.length;for(n=0;o>n;n++)t[n]&&(i.eventSource=e,i.userData=t[n].userData,t[n].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){function t(t){var i,n=me[t.hash],o=n.activePointersLists.length;for(i=0;o>i;i++)n.activePointersLists[i].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;o>i;i++)n.activePointersLists.pop()}function i(i){var n,o,r=me[i.hash];if(!r.tracking){for(o=0;o<e.MouseTracker.subscribeEvents.length;o++)n=e.MouseTracker.subscribeEvents[o],e.addEvent(i.element,n,r[n],!1);t(i),r.tracking=!0}}function n(i){var n,o,r=me[i.hash];if(r.tracking){for(o=0;o<e.MouseTracker.subscribeEvents.length;o++)n=e.MouseTracker.subscribeEvents[o],e.removeEvent(i.element,n,r[n],!1);t(i),r.tracking=!1}}function o(t,i){var n=me[t.hash];if("pointerevent"===i)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:n.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:n.pointermovecaptured};if("mouse"===i)return{upName:"mouseup",upHandler:n.mouseupcaptured,moveName:"mousemove",moveHandler:n.mousemovecaptured};if("touch"===i)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function r(t,i){var n,r=t.getActivePointersListByType(i);r.captureCount++,1===r.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(n=o(t,e.MouseTracker.havePointerEvents?"pointerevent":i),e.addEvent(e.MouseTracker.captureElement,n.upName,n.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,n.moveName,n.moveHandler,!0)))}function s(t,i){var n,r=t.getActivePointersListByType(i);r.captureCount--,0===r.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(n=o(t,e.MouseTracker.havePointerEvents?"pointerevent":i),e.removeEvent(e.MouseTracker.captureElement,n.moveName,n.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,n.upName,n.upHandler,!0)))}function a(t){var i;if(e.MouseTracker.unprefixedPointerEvents)i=t.pointerType;else switch(t.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function l(t){return e.getMousePosition(t)}function c(e,t){return h(l(e),t)}function h(t,i){var n=e.getElementOffset(i);return t.minus(n)}function u(t,i){return new e.Point((t.x+i.x)/2,(t.y+i.y)/2)}function d(t,i){t.clickHandler&&e.cancelEvent(i)}function p(t,i){t.dblClickHandler&&e.cancelEvent(i)}function m(t,i){var n;t.keyDownHandler&&(i=e.getEvent(i),n=t.keyDownHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n||e.cancelEvent(i))}function g(t,i){var n;t.keyUpHandler&&(i=e.getEvent(i),n=t.keyUpHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n||e.cancelEvent(i))}function v(t,i){var n;t.keyHandler&&(i=e.getEvent(i),n=t.keyHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n||e.cancelEvent(i))}function f(t,i){var n;t.focusHandler&&(i=e.getEvent(i),n=t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n===!1&&e.cancelEvent(i))}function y(t,i){var n;t.blurHandler&&(i=e.getEvent(i),n=t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),n===!1&&e.cancelEvent(i))}function w(e,t){S(e,t,t)}function T(t,i){i=e.getEvent(i);var n={target:i.target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};n.deltaY="mousewheel"==e.MouseTracker.wheelEventName?-1/e.DEFAULT_SETTINGS.pixelsPerWheelLine*i.wheelDelta:i.detail,S(t,n,i)}function S(t,i,n){var o,r=0;r=i.deltaY<0?1:-1,t.scrollHandler&&(o=t.scrollHandler({eventSource:t,pointerType:"mouse",position:c(i,t.element),scroll:r,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:t.userData}),o===!1&&e.cancelEvent(n))}function E(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function x(t,i){i=e.getEvent(i),b(t,i)}function P(t,i){i=e.getEvent(i),i.currentTarget===i.relatedTarget||E(i.currentTarget,i.relatedTarget)||b(t,i)}function b(t,i){var n={id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:e.now()};se(t,i,[n])}function R(t,i){i=e.getEvent(i),C(t,i)}function k(t,i){i=e.getEvent(i),i.currentTarget===i.relatedTarget||E(i.currentTarget,i.relatedTarget)||C(t,i)}function C(t,i){var n={id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:e.now()};ae(t,i,[n])}function O(t){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===t?0:2===t?2:4===t?1:-1:t}function H(t,i){var n;i=e.getEvent(i),n={id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:e.now()},le(t,i,[n],O(i.button))&&(e.stopEvent(i),r(t,"mouse")),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(i)}function M(e,t){I(e,t)}function z(t,i){I(t,i),e.stopEvent(i)}function I(t,i){var n;i=e.getEvent(i),n={id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:e.now()},ce(t,i,[n],O(i.button))&&s(t,"mouse")}function D(e,t){L(e,t)}function B(t,i){L(t,i),e.stopEvent(i)}function L(t,i){var n;i=e.getEvent(i),n={id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:l(i),currentTime:e.now()},he(t,i,[n])}function F(e,t,i){var n,o=i.getLength(),r=[];for(n=0;o>n;n++)r.push(i.getByIndex(n));r.length>0&&(ce(e,t,r,0),i.captureCount=1,s(e,"touch"),ae(e,t,r))}function A(t,i){var n,o,s,a,c=i.changedTouches.length,h=[],u=t.getActivePointersListByType("touch");for(n=e.now(),u.getLength()>i.touches.length-c&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),F(t,i,u)),o=0;c>o;o++)h.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:l(i.changedTouches[o]),currentTime:n});for(se(t,i,h),o=0;o<pe.length;o++)if(pe[o]!==t&&pe[o].isTracking()&&E(pe[o].element,t.element)){for(a=[],s=0;c>s;s++)a.push({id:i.changedTouches[s].identifier,type:"touch",currentPos:l(i.changedTouches[s]),currentTime:n});se(pe[o],i,a)}le(t,i,h,0)&&(e.stopEvent(i),r(t,"touch")),e.cancelEvent(i)}function N(e,t){$(e,t)}function U(t,i){$(t,i),e.stopEvent(i)}function $(t,i){var n,o,r,a,c=i.changedTouches.length,h=[];for(n=e.now(),o=0;c>o;o++)h.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:l(i.changedTouches[o]),currentTime:n});for(ce(t,i,h,0)&&s(t,"touch"),ae(t,i,h),o=0;o<pe.length;o++)if(pe[o]!==t&&pe[o].isTracking()&&E(pe[o].element,t.element)){for(a=[],r=0;c>r;r++)a.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:l(i.changedTouches[r]),currentTime:n});ae(pe[o],i,a)}e.cancelEvent(i)}function _(e,t){Z(e,t)}function G(t,i){Z(t,i),e.stopEvent(i)}function Z(t,i){var n,o=i.changedTouches.length,r=[];for(n=0;o>n;n++)r.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:l(i.changedTouches[n]),currentTime:e.now()});he(t,i,r),e.cancelEvent(i)}function W(e,t){var i,n=t.changedTouches.length,o=[];for(i=0;n>i;i++)o.push({id:t.changedTouches[i].identifier,type:"touch"});ue(e,t,o)}function V(e,t){return t.stopPropagation(),t.preventDefault(),!1}function j(e,t){return t.stopPropagation(),t.preventDefault(),!1}function q(t,i){var n;i.currentTarget===i.relatedTarget||E(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:e.now()},se(t,i,[n]))}function X(t,i){var n;i.currentTarget===i.relatedTarget||E(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:e.now()},ae(t,i,[n]))}function Y(t,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:e.now()},le(t,i,[n],i.button)&&(e.stopEvent(i),r(t,n.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(i)}function K(e,t){J(e,t)}function Q(t,i){var n=t.getActivePointersListByType(a(i));n.getById(i.pointerId)&&J(t,i),e.stopEvent(i)}function J(t,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:e.now()},ce(t,i,[n],i.button)&&s(t,n.type)}function ee(e,t){ie(e,t)}function te(t,i){var n=t.getActivePointersListByType(a(i));n.getById(i.pointerId)&&ie(t,i),e.stopEvent(i)}function ie(t,i){var n;n={id:i.pointerId,type:a(i),isPrimary:i.isPrimary,currentPos:l(i),currentTime:e.now()},he(t,i,[n])}function ne(e,t){var i;i={id:t.pointerId,type:a(t)},ue(e,t,[i])}function oe(e,t){return t.hasOwnProperty("isPrimary")||(t.isPrimary=0===e.getLength()?!0:!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function re(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),t.hasOwnProperty("isPrimary")||(n=e.getPrimary(),n||(n=e.getByIndex(0),n&&(n.isPrimary=!0)))):i=e.getLength(),i}function se(t,i,n){var o,r,s,a,l=t.getActivePointersListByType(n[0].type),c=n.length;for(o=0;c>o;o++)r=n[o],s=l.getById(r.id),s?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime,r=s):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,oe(l,r)),t.enterHandler&&(a=t.enterHandler({eventSource:t,pointerType:r.type,position:h(r.currentPos,t.element),buttons:l.buttons,pointers:t.getActivePointerCount(),insideElementPressed:r.insideElementPressed,buttonDownAny:0!==l.buttons,isTouchEvent:"touch"===r.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),a===!1&&e.cancelEvent(i))}function ae(t,i,n){var o,r,s,a,l=(me[t.hash],t.getActivePointersListByType(n[0].type)),c=n.length;for(o=0;c>o;o++)r=n[o],s=l.getById(r.id),s&&(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime):re(l,s),r=s),t.exitHandler&&(a=t.exitHandler({eventSource:t,pointerType:r.type,position:h(r.currentPos,t.element),buttons:l.buttons,pointers:t.getActivePointerCount(),insideElementPressed:s?s.insideElementPressed:!1,buttonDownAny:0!==l.buttons,isTouchEvent:"touch"===r.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),a===!1&&e.cancelEvent(i))}function le(t,i,n,o){var r,s,a,l,c=me[t.hash],d=t.getActivePointersListByType(n[0].type),p=n.length;if("undefined"!=typeof i.buttons?d.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===o?d.buttons+=1:1===o?d.buttons+=4:2===o?d.buttons+=2:3===o?d.buttons+=8:4===o?d.buttons+=16:5===o&&(d.buttons+=32):0===o?d.buttons|=1:1===o?d.buttons|=4:2===o?d.buttons|=2:3===o?d.buttons|=8:4===o?d.buttons|=16:5===o&&(d.buttons|=32),0!==o)return t.nonPrimaryPressHandler&&(r=t.nonPrimaryPressHandler({eventSource:t,pointerType:n[0].type,position:h(n[0].currentPos,t.element),button:o,buttons:d.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)),!1;for(s=0;p>s;s++)a=n[s],l=d.getById(a.id),l?(l.captured=!0,l.insideElementPressed=!0,l.insideElement=!0,l.contactPos=a.currentPos,l.contactTime=a.currentTime,l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=a.currentPos,l.currentTime=a.currentTime,a=l):(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,oe(d,a)),d.contacts++,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,a),1===d.contacts?t.pressHandler&&(r=t.pressHandler({eventSource:t,
pointerType:a.type,position:h(a.contactPos,t.element),buttons:d.buttons,isTouchEvent:"touch"===a.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)):2===d.contacts&&t.pinchHandler&&"touch"===a.type&&(c.pinchGPoints=d.asArray(),c.lastPinchDist=c.currentPinchDist=c.pinchGPoints[0].currentPos.distanceTo(c.pinchGPoints[1].currentPos),c.lastPinchCenter=c.currentPinchCenter=u(c.pinchGPoints[0].currentPos,c.pinchGPoints[1].currentPos));return!0}function ce(t,i,n,o){var r,s,a,l,c,d,p,m=me[t.hash],g=t.getActivePointersListByType(n[0].type),v=n.length,f=!1,y=!1;if("undefined"!=typeof i.buttons?g.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===o?g.buttons-=1:1===o?g.buttons-=4:2===o?g.buttons-=2:3===o?g.buttons-=8:4===o?g.buttons-=16:5===o&&(g.buttons-=32):0===o?g.buttons^=-2:1===o?g.buttons^=-5:2===o?g.buttons^=-3:3===o?g.buttons^=-9:4===o?g.buttons^=-17:5===o&&(g.buttons^=-33),0!==o)return t.nonPrimaryReleaseHandler&&(r=t.nonPrimaryReleaseHandler({eventSource:t,pointerType:n[0].type,position:h(n[0].currentPos,t.element),button:o,buttons:g.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)),!1;for(l=0;v>l;l++)c=n[l],d=g.getById(c.id),d&&(d.captured&&(d.captured=!1,f=!0,y=!0),d.lastPos=d.currentPos,d.lastTime=d.currentTime,d.currentPos=c.currentPos,d.currentTime=c.currentTime,d.insideElement||re(g,d),s=d.currentPos,a=d.currentTime,y?(g.contacts--,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,d),0===g.contacts?(t.releaseHandler&&(r=t.releaseHandler({eventSource:t,pointerType:d.type,position:h(s,t.element),buttons:g.buttons,insideElementPressed:d.insideElementPressed,insideElementReleased:d.insideElement,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)),t.dragEndHandler&&!d.currentPos.equals(d.contactPos)&&(r=t.dragEndHandler({eventSource:t,pointerType:d.type,position:h(d.currentPos,t.element),speed:d.speed,direction:d.direction,shift:i.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)),(t.clickHandler||t.dblClickHandler)&&d.insideElement&&(p=a-d.contactTime<=t.clickTimeThreshold&&d.contactPos.distanceTo(s)<=t.clickDistThreshold,t.clickHandler&&(r=t.clickHandler({eventSource:t,pointerType:d.type,position:h(d.currentPos,t.element),quick:p,shift:i.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)),t.dblClickHandler&&p&&(g.clicks++,1===g.clicks?(m.lastClickPos=s,m.dblClickTimeOut=setTimeout(function(){g.clicks=0},t.dblClickTimeThreshold)):2===g.clicks&&(clearTimeout(m.dblClickTimeOut),g.clicks=0,m.lastClickPos.distanceTo(s)<=t.dblClickDistThreshold&&(r=t.dblClickHandler({eventSource:t,pointerType:d.type,position:h(d.currentPos,t.element),shift:i.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)),m.lastClickPos=null)))):2===g.contacts&&t.pinchHandler&&"touch"===d.type&&(m.pinchGPoints=g.asArray(),m.lastPinchDist=m.currentPinchDist=m.pinchGPoints[0].currentPos.distanceTo(m.pinchGPoints[1].currentPos),m.lastPinchCenter=m.currentPinchCenter=u(m.pinchGPoints[0].currentPos,m.pinchGPoints[1].currentPos))):t.releaseHandler&&(r=t.releaseHandler({eventSource:t,pointerType:d.type,position:h(s,t.element),buttons:g.buttons,insideElementPressed:d.insideElementPressed,insideElementReleased:d.insideElement,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),r===!1&&e.cancelEvent(i)));return f}function he(t,i,n){var o,r,s,a,l,c,d=me[t.hash],p=t.getActivePointersListByType(n[0].type),m=n.length;for("undefined"!=typeof i.buttons&&(p.buttons=i.buttons),o=0;m>o;o++)r=n[o],s=p.getById(r.id),s?(r.hasOwnProperty("isPrimary")&&(s.isPrimary=r.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,oe(p,r));t.stopHandler&&"mouse"===n[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout(function(){de(t,i,n[0].type)},t.stopDelay)),0===p.contacts?t.moveHandler&&(c=t.moveHandler({eventSource:t,pointerType:n[0].type,position:h(n[0].currentPos,t.element),buttons:p.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),c===!1&&e.cancelEvent(i)):1===p.contacts?(t.moveHandler&&(s=p.asArray()[0],c=t.moveHandler({eventSource:t,pointerType:s.type,position:h(s.currentPos,t.element),buttons:p.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),c===!1&&e.cancelEvent(i)),t.dragHandler&&(s=p.asArray()[0],l=s.currentPos.minus(s.lastPos),c=t.dragHandler({eventSource:t,pointerType:s.type,position:h(s.currentPos,t.element),buttons:p.buttons,delta:l,speed:s.speed,direction:s.direction,shift:i.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),c===!1&&e.cancelEvent(i))):2===p.contacts&&(t.moveHandler&&(a=p.asArray(),c=t.moveHandler({eventSource:t,pointerType:a[0].type,position:h(u(a[0].currentPos,a[1].currentPos),t.element),buttons:p.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),c===!1&&e.cancelEvent(i)),t.pinchHandler&&"touch"===n[0].type&&(l=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos),l!=d.currentPinchDist&&(d.lastPinchDist=d.currentPinchDist,d.currentPinchDist=l,d.lastPinchCenter=d.currentPinchCenter,d.currentPinchCenter=u(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos),c=t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:d.pinchGPoints,lastCenter:h(d.lastPinchCenter,t.element),center:h(d.currentPinchCenter,t.element),lastDistance:d.lastPinchDist,distance:d.currentPinchDist,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData}),c===!1&&e.cancelEvent(i))))}function ue(e,t,i){ce(e,t,i,0),ae(e,t,i)}function de(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:c(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}var pe=[],me={};e.MouseTracker=function(t){pe.push(this);var i=arguments;e.isPlainObject(t)||(t={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var n=this;me[this.hash]={click:function(e){d(n,e)},dblclick:function(e){p(n,e)},keydown:function(e){m(n,e)},keyup:function(e){g(n,e)},keypress:function(e){v(n,e)},focus:function(e){f(n,e)},blur:function(e){y(n,e)},wheel:function(e){w(n,e)},mousewheel:function(e){T(n,e)},DOMMouseScroll:function(e){T(n,e)},MozMousePixelScroll:function(e){T(n,e)},mouseenter:function(e){x(n,e)},mouseleave:function(e){R(n,e)},mouseover:function(e){P(n,e)},mouseout:function(e){k(n,e)},mousedown:function(e){H(n,e)},mouseup:function(e){M(n,e)},mouseupcaptured:function(e){z(n,e)},mousemove:function(e){D(n,e)},mousemovecaptured:function(e){B(n,e)},touchstart:function(e){A(n,e)},touchend:function(e){N(n,e)},touchendcaptured:function(e){U(n,e)},touchmove:function(e){_(n,e)},touchmovecaptured:function(e){G(n,e)},touchcancel:function(e){W(n,e)},gesturestart:function(e){V(n,e)},gesturechange:function(e){j(n,e)},pointerover:function(e){q(n,e)},MSPointerOver:function(e){q(n,e)},pointerout:function(e){X(n,e)},MSPointerOut:function(e){X(n,e)},pointerdown:function(e){Y(n,e)},MSPointerDown:function(e){Y(n,e)},pointerup:function(e){K(n,e)},MSPointerUp:function(e){K(n,e)},pointermove:function(e){ee(n,e)},MSPointerMove:function(e){ee(n,e)},pointercancel:function(e){ne(n,e)},MSPointerCancel:function(e){ne(n,e)},pointerupcaptured:function(e){Q(n,e)},pointermovecaptured:function(e){te(n,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;for(n(this),this.element=null,e=0;e<pe.length;e++)if(pe[e]===this){pe.splice(e,1);break}me[this.hash]=null,delete me[this.hash]},isTracking:function(){return me[this.hash].tracking},setTracking:function(e){return e?i(this):n(this),this},getActivePointersListByType:function(t){var i,n,o=me[this.hash],r=o.activePointersLists.length;for(i=0;r>i;i++)if(o.activePointersLists[i].type===t)return o.activePointersLists[i];return n=new e.MouseTracker.GesturePointList(t),o.activePointersLists.push(n),n},getActivePointerCount:function(){var e,t=me[this.hash],i=t.activePointersLists.length,n=0;for(e=0;i>e;e++)n+=t.activePointersLists[e].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.gesturePointVelocityTracker=function(){var t=[],i=0,n=0,o=function(e,t){return e.hash.toString()+t.type+t.id.toString()},r=function(){var i,o,r,s,a,l,c=t.length,h=e.now();for(s=h-n,n=h,i=0;c>i;i++)o=t[i],r=o.gPoint,r.direction=Math.atan2(r.currentPos.y-o.lastPos.y,r.currentPos.x-o.lastPos.x),a=o.lastPos.distanceTo(r.currentPos),o.lastPos=r.currentPos,l=1e3*a/(s+1),r.speed=.75*l+.25*r.speed},s=function(s,a){var l=o(s,a);t.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===t.length&&(n=e.now(),i=window.setInterval(r,50))},a=function(e,n){var r,s=o(e,n),a=t.length;for(r=0;a>r;r++)if(t[r].guid===s){t.splice(r,1),a--,0===a&&window.clearInterval(i);break}};return{addPoint:s,removePoint:a}}(),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=function(){var t=document.createElement("div");return e.isFunction(t.setCapture)&&e.isFunction(t.releaseCapture)}(),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints?navigator.maxTouchPoints:0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints?navigator.msMaxTouchPoints:0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;i>t;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;i>t;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(){var e,t=this._gPoints.length;for(e=0;t>e;e++)if(this._gPoints[e].isPrimary)return this._gPoints[e];return null}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var o=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer="undefined"==typeof i.attachToViewer?!0:i.attachToViewer,this.autoFade="undefined"==typeof i.autoFade?!0:i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==t)return i;return-1}e.ControlDock=function(t){var i,n,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<o.length;n++)i=o[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){i=e.getElement(i);var o=null;if(!(t(this,i)>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:o=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case e.ControlAnchor.NONE:o=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,o)),i.style.display="inline-block"}},removeControl:function(i){i=e.getElement(i);var n=t(this,i);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function($){function _getSafeElemSize(e){return e=$.getElement(e),new $.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function getTileSourceImplementation(viewer,tileSource,successCallback,failCallback){var _this=viewer;"string"==$.type(tileSource)&&(tileSource.match(/\s*<.*/)?tileSource=$.parseXml(tileSource):tileSource.match(/\s*[\{\[].*/)&&(tileSource=eval("("+tileSource+")"))),setTimeout(function(){if("string"==$.type(tileSource))tileSource=new $.TileSource(tileSource,function(e){successCallback(e.tileSource)}),tileSource.addHandler("open-failed",function(e){failCallback(e)});else if($.isPlainObject(tileSource)||tileSource.nodeType)if($.isFunction(tileSource.getTileUrl)){var e=new $.TileSource(tileSource);e.getTileUrl=tileSource.getTileUrl,successCallback(e)}else{var t=$.TileSource.determineType(_this,tileSource);if(!t)return void failCallback({message:"Unable to load TileSource",source:tileSource});var i=t.prototype.configure.apply(_this,[tileSource]),n=new t(i);successCallback(n)}else successCallback(tileSource)},1)}function openTileSource(e,t){var i,n=e;return n.source&&n.close(),THIS[n.hash].prevContainerSize=_getSafeElemSize(n.container),n.collectionMode?(n.source=new $.TileSourceCollection({rows:n.collectionRows,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileSources:n.tileSources,tileMargin:n.collectionTileMargin}),n.viewport=n.viewport?n.viewport:new $.Viewport({collectionMode:!0,collectionTileSource:n.source,containerSize:THIS[n.hash].prevContainerSize,contentSize:n.source.dimensions,springStiffness:n.springStiffness,animationTime:n.animationTime,showNavigator:!1,minZoomImageRatio:1,maxZoomPixelRatio:1,viewer:n,degrees:n.degrees})):(t&&(n.source=t),n.viewport=n.viewport?n.viewport:new $.Viewport({containerSize:THIS[n.hash].prevContainerSize,contentSize:n.source.dimensions,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,maxZoomPixelRatio:n.maxZoomPixelRatio,visibilityRatio:n.visibilityRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,defaultZoomLevel:n.defaultZoomLevel,minZoomLevel:n.minZoomLevel,maxZoomLevel:n.maxZoomLevel,viewer:n,degrees:n.degrees,navigatorRotate:n.navigatorRotate,homeFillsViewer:n.homeFillsViewer})),n.preserveViewport&&n.viewport.resetContentSize(n.source.dimensions),n.preserveOverlays&&(n.overlays=n.currentOverlays),n.source.overlays=n.source.overlays||[],n.drawer=new $.Drawer({viewer:n,source:n.source,viewport:n.viewport,element:n.drawersContainer,opacity:n.opacity,maxImageCacheCount:n.maxImageCacheCount,imageLoaderLimit:n.imageLoaderLimit,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.collectionMode?0:n.minPixelRatio,timeout:n.timeout,debugMode:n.debugMode,debugGridColor:n.debugGridColor,crossOriginPolicy:n.crossOriginPolicy}),n.drawers=[n.drawer],n.drawer.canRotate()||(n.rotateLeft&&(i=n.buttons.buttons.indexOf(n.rotateLeft),n.buttons.buttons.splice(i,1),n.buttons.element.removeChild(n.rotateLeft.element)),n.rotateRight&&(i=n.buttons.buttons.indexOf(n.rotateRight),n.buttons.buttons.splice(i,1),n.buttons.element.removeChild(n.rotateRight.element))),n.showNavigator&&!n.collectionMode&&(n.navigator?n.navigator.open(t):n.navigator=new $.Navigator({id:n.navigatorId,position:n.navigatorPosition,sizeRatio:n.navigatorSizeRatio,maintainSizeRatio:n.navigatorMaintainSizeRatio,top:n.navigatorTop,left:n.navigatorLeft,width:n.navigatorWidth,height:n.navigatorHeight,autoResize:n.navigatorAutoResize,tileSources:t,tileHost:n.tileHost,prefixUrl:n.prefixUrl,viewer:n,navigatorRotate:n.navigatorRotate})),n.showReferenceStrip&&!n.referenceStrip&&(n.referenceStrip=new $.ReferenceStrip({id:n.referenceStripElement,position:n.referenceStripPosition,sizeRatio:n.referenceStripSizeRatio,scroll:n.referenceStripScroll,height:n.referenceStripHeight,width:n.referenceStripWidth,tileSources:n.tileSources,tileHost:n.tileHost,prefixUrl:n.prefixUrl,viewer:n})),THIS[n.hash].animating=!1,THIS[n.hash].forceRedraw=!0,n._updateRequestId=scheduleUpdate(n,updateMulti),VIEWERS[n.hash]=n,loadOverlays(n),n.raiseEvent("open",{source:t}),n}function loadOverlays(e){e.currentOverlays=[];for(var t=0;t<e.overlays.length;t++)e.currentOverlays[t]=getOverlayObject(e,e.overlays[t]);for(var i=0;i<e.source.overlays.length;i++)e.currentOverlays[t+i]=getOverlayObject(e,e.source.overlays[i])}function getOverlayObject(e,t){if(t instanceof $.Overlay)return t;var i=null;if(t.element)i=$.getElement(t.element);else{var n=t.id?t.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());i=$.getElement(t.id),i||(i=document.createElement("a"),i.href="#/overlay/"+n),i.id=n,$.addClass(i,t.className?t.className:"openseadragon-overlay")}var o=t.location;o||(o=t.width&&t.height?void 0!==t.px?e.viewport.imageToViewportRectangle(new $.Rect(t.px,t.py,t.width,t.height)):new $.Rect(t.x,t.y,t.width,t.height):void 0!==t.px?e.viewport.imageToViewportCoordinates(new $.Point(t.px,t.py)):new $.Point(t.x,t.y));var r=t.placement;return r&&"string"===$.type(r)&&(r=$.OverlayPlacement[t.placement.toUpperCase()]),new $.Overlay({element:i,location:o,placement:r,onDraw:t.onDraw,checkResize:t.checkResize})}function getOverlayIndex(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===t)return i;return-1}function drawOverlays(e,t,i){var n,o=t.length;for(n=0;o>n;n++)t[n].drawHTML(i,e)}function scheduleUpdate(e,t){return $.requestAnimationFrame(function(){t(e)})}function scheduleControlsFade(e){$.requestAnimationFrame(function(){updateControlsFade(e)})}function beginControlsAutoHide(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=$.now()+e.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(e)},e.controlsFadeDelay))}function updateControlsFade(e){var t,i,n,o;if(e.controlsShouldFade){for(t=$.now(),i=t-e.controlsFadeBeginTime,n=1-i/e.controlsFadeLength,n=Math.min(1,n),n=Math.max(0,n),o=e.controls.length-1;o>=0;o--)e.controls[o].autoFade&&e.controls[o].setOpacity(n);n>0&&scheduleControlsFade(e)}}function abortControlsAutoHide(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasKeyDown(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(new $.Point(0,-.05)),this.viewport.applyConstraints(),!1;case 40:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(new $.Point(0,.05)),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(new $.Point(-.05,0)),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(new $.Point(.05,0)),this.viewport.applyConstraints(),!1;default:return!0}}function onCanvasKeyPress(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(new $.Point(0,-.05)),this.viewport.applyConstraints(),!1;case 115:case 83:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(new $.Point(0,.05)),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(new $.Point(-.05,0)),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(new $.Point(.05,0)),this.viewport.applyConstraints(),!1;default:return!0}}function onCanvasClick(e){var t,i=document.activeElement==this.canvas;i||this.canvas.focus(),!e.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-click",{tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent})}function onCanvasDblClick(e){var t;!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-double-click",{tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent})}function onCanvasDrag(e){var t;!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled),this.constrainDuringPan&&this.viewport.applyConstraints()),this.raiseEvent("canvas-drag",{tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function onCanvasDragEnd(e){var t;if(!e.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),t.flickEnabled&&e.speed>=t.flickMinSpeed){var i=t.flickMomentum*e.speed*Math.cos(e.direction-Math.PI/180*this.viewport.degrees),n=t.flickMomentum*e.speed*Math.sin(e.direction-Math.PI/180*this.viewport.degrees),o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),r=this.viewport.pointFromPixel(new $.Point(o.x-i,o.y-n));this.panHorizontal||(r.x=o.x),this.panVertical||(r.y=o.y),this.viewport.panTo(r,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:e.eventSource,position:e.position,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function onCanvasEnter(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function onCanvasExit(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function onCanvasPress(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function onCanvasRelease(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function onCanvasNonPrimaryPress(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function onCanvasNonPrimaryRelease(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function onCanvasPinch(e){var t,i,n,o;if(!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.pinchToZoom&&(i=this.viewport.pointFromPixel(e.center,!0),n=this.viewport.pointFromPixel(e.lastCenter,!0),o=n.minus(i),this.panHorizontal||(o.x=0),this.panVertical||(o.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),this.viewport.panBy(o,!0),this.viewport.applyConstraints()),t.pinchRotate)){var r=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),s=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(r-s)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function onCanvasScroll(e){var t,i;return!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.scrollToZoom&&(i=Math.pow(this.zoomPerScroll,e.scroll),this.viewport.zoomBy(i,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function onContainerEnter(e){THIS[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function onContainerExit(e){e.pointers<1&&(THIS[this.hash].mouseInside=!1,THIS[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function updateMulti(e){return e.source?(updateOnce(e),void(e.source&&(e._updateRequestId=scheduleUpdate(e,updateMulti)))):void(e._updateRequestId=null)}function updateOnce(e){var t,i;if(e.source){if(e.autoResize&&(t=_getSafeElemSize(e.container),!t.equals(THIS[e.hash].prevContainerSize))){var n=e.viewport.getBounds(),o=e.viewport.getCenter();resizeViewportAndRecenter(e,t,n,o),
THIS[e.hash].prevContainerSize=t,THIS[e.hash].forceRedraw=!0}i=e.viewport.update(),e.referenceStrip&&(i=e.referenceStrip.update(e.viewport)||i),!THIS[e.hash].animating&&i&&(e.raiseEvent("animation-start"),abortControlsAutoHide(e)),i?(updateDrawers(e),drawOverlays(e.viewport,e.currentOverlays,e.overlaysContainer),e.navigator&&e.navigator.update(e.viewport),e.raiseEvent("animation")):(THIS[e.hash].forceRedraw||drawersNeedUpdate(e))&&(updateDrawers(e),drawOverlays(e.viewport,e.currentOverlays,e.overlaysContainer),e.navigator&&e.navigator.update(e.viewport),THIS[e.hash].forceRedraw=!1),THIS[e.hash].animating&&!i&&(e.raiseEvent("animation-finish"),THIS[e.hash].mouseInside||beginControlsAutoHide(e)),THIS[e.hash].animating=i}}function resizeViewportAndRecenter(e,t,i,n){var o=e.viewport;o.resize(t,!0);var r=1/e.source.aspectRatio,s=i.width<=1?i.width:1,a=i.height<=r?i.height:r,l=new $.Rect(n.x-s/2,n.y-a/2,s,a);o.fitBounds(l,!0)}function updateDrawers(e){for(var t=0;t<e.drawers.length;t++)e.drawers[t].update()}function drawersNeedUpdate(e){for(var t=0;t<e.drawers.length;t++)if(e.drawers[t].needsUpdate())return!0;return!1}function resolveUrl(e,t){return e?e+t:t}function beginZoomingIn(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){THIS[this.hash].lastZoomTime=$.now(),THIS[this.hash].zoomFactor=1/this.zoomPerSecond,THIS[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){THIS[this.hash].zooming=!1}function scheduleZoom(e){$.requestAnimationFrame($.delegate(e,doZoom))}function doZoom(){var e,t,i;THIS[this.hash].zooming&&this.viewport&&(e=$.now(),t=e-THIS[this.hash].lastZoomTime,i=Math.pow(THIS[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(i),this.viewport.applyConstraints(),THIS[this.hash].lastZoomTime=e,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(THIS[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullScreen(){this.isFullPage()&&!$.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onRotateLeft(){if(this.viewport){var e=this.viewport.getRotation();0===e?e=270:e-=90,this.viewport.setRotation(e)}}function onRotateRight(){if(this.viewport){var e=this.viewport.getRotation();270===e?e=0:e+=90,this.viewport.setRotation(e)}}function onPrevious(){var e=THIS[this.hash].sequence-1;this.navPrevNextWrap&&0>e&&(e+=this.tileSources.length),this.goToPage(e)}function onNext(){var e=THIS[this.hash].sequence+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}var THIS={},VIEWERS={};$.Viewer=function(e){var t,i=arguments,n=this;if($.isPlainObject(e)||(e={id:i[0],xmlPath:i.length>1?i[1]:void 0,prefixUrl:i.length>2?i[2]:void 0,controls:i.length>3?i[3]:void 0,overlays:i.length>4?i[4]:void 0}),e.config&&($.extend(!0,e,e.config),delete e.config),$.extend(!0,this,{id:e.id,hash:e.hash||e.id,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,drawers:[],drawersContainer:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},$.DEFAULT_SETTINGS,e),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");"undefined"!=typeof THIS[this.hash]&&$.console.warn("Hash "+this.hash+" has already been used."),THIS[this.hash]={fsBoundsDelta:new $.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,sequenced:!1,sequence:0,fullPage:!1,onfullscreenchange:null},this._updateRequestId=null,this.currentOverlays=[],$.EventSource.call(this),this.addHandler("open-failed",function(e){var t=$.getString("Errors.OpenFailed",e.eventSource,e.message);n._showMessage(t)}),$.ControlDock.call(this,e);var o;for(this.xmlPath&&(this.tileSources=[this.xmlPath]),this.tileSources&&($.isArray(this.tileSources)?(this.tileSources.length>1&&(THIS[this.hash].sequenced=!0),this.initialPage>this.tileSources.length-1&&(this.initialPage=this.tileSources.length-1),o=this.tileSources[this.initialPage],THIS[this.hash].sequence=this.initialPage):o=this.tileSources),this.element=this.element||document.getElementById(this.id),this.canvas=$.makeNeutralElement("div"),this.drawersContainer=$.makeNeutralElement("div"),this.overlaysContainer=$.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),$.setElementTouchActionNone(this.canvas),this.canvas.tabIndex=e.tabIndex||0,this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.canvas.appendChild(this.drawersContainer),this.canvas.appendChild(this.overlaysContainer),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new $.MouseTracker({element:this.canvas,startDisabled:this.mouseNavEnabled?!1:!0,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:$.delegate(this,onCanvasKeyDown),keyHandler:$.delegate(this,onCanvasKeyPress),clickHandler:$.delegate(this,onCanvasClick),dblClickHandler:$.delegate(this,onCanvasDblClick),dragHandler:$.delegate(this,onCanvasDrag),dragEndHandler:$.delegate(this,onCanvasDragEnd),enterHandler:$.delegate(this,onCanvasEnter),exitHandler:$.delegate(this,onCanvasExit),pressHandler:$.delegate(this,onCanvasPress),releaseHandler:$.delegate(this,onCanvasRelease),nonPrimaryPressHandler:$.delegate(this,onCanvasNonPrimaryPress),nonPrimaryReleaseHandler:$.delegate(this,onCanvasNonPrimaryRelease),scrollHandler:$.delegate(this,onCanvasScroll),pinchHandler:$.delegate(this,onCanvasPinch)}),this.outerTracker=new $.MouseTracker({element:this.container,startDisabled:this.mouseNavEnabled?!1:!0,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:$.delegate(this,onContainerEnter),exitHandler:$.delegate(this,onContainerExit)}),this.toolbar&&(this.toolbar=new $.ControlDock({element:this.toolbar})),this.bindStandardControls(),this.bindSequenceControls(),o&&(this.open(o),this.tileSources.length>1&&this._updateSequenceButtons(this.initialPage)),t=0;t<this.customControls.length;t++)this.addControl(this.customControls[t].id,{anchor:this.customControls[t].anchor});$.requestAnimationFrame(function(){beginControlsAutoHide(n)})},$.extend($.Viewer.prototype,$.EventSource.prototype,$.ControlDock.prototype,{isOpen:function(){return!!this.source},openDzi:function(e){return this.open(e)},openTileSource:function(e){return this.open(e)},open:function(e){var t=this;return t._hideMessage(),getTileSourceImplementation(t,e,function(e){openTileSource(t,e)},function(e){t.raiseEvent("open-failed",e)}),this},close:function(){return THIS[this.hash]?(null!==this._updateRequestId&&($.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),this.drawersContainer.innerHTML="",this.drawer&&this.drawer.destroy(),this.source=null,this.drawer=null,this.drawers=[],this.viewport=this.preserveViewport?this.viewport:null,VIEWERS[this.hash]=null,delete VIEWERS[this.hash],this.raiseEvent("close"),this):this},destroy:function(){if(this.close(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),THIS[this.hash]=null,delete THIS[this.hash],this.canvas=null,this.container=null,this.element=null},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?abortControlsAutoHide(this):beginControlsAutoHide(this),this.raiseEvent("controls-enabled",{enabled:e}),this},isFullPage:function(){return THIS[this.hash].fullPage},setFullPage:function(e){var t,i,n=document.body,o=n.style,r=document.documentElement.style,s=this;if(e==this.isFullPage())return this;var a={fullPage:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",a),a.preventDefaultAction)return this;if(e){for(this.elementSize=$.getElementSize(this.element),this.pageScroll=$.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=r.margin,o.margin="0",r.margin="0",this.bodyPadding=o.padding,this.docPadding=r.padding,o.padding="0",r.padding="0",this.bodyWidth=o.width,this.bodyHeight=o.height,o.width="100%",o.height="100%",this.previousBody=[],THIS[this.hash].prevElementParent=this.element.parentNode,THIS[this.hash].prevNextSibling=this.element.nextSibling,THIS[this.hash].prevElementWidth=this.element.style.width,THIS[this.hash].prevElementHeight=this.element.style.height,t=n.childNodes.length,i=0;t>i;i++)this.previousBody.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,n.appendChild(this.toolbar.element),$.addClass(this.toolbar.element,"fullpage")),$.addClass(this.element,"fullpage"),n.appendChild(this.element),this.element.style.height=$.getWindowSize().y+"px",this.element.style.width=$.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=$.getElementSize(this.element).y-$.getElementSize(this.toolbar.element).y+"px"),THIS[this.hash].fullPage=!0,$.delegate(this,onContainerEnter)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,r.margin=this.docMargin,o.padding=this.bodyPadding,r.padding=this.docPadding,o.width=this.bodyWidth,o.height=this.bodyHeight,n.removeChild(this.element),t=this.previousBody.length,i=0;t>i;i++)n.appendChild(this.previousBody.shift());$.removeClass(this.element,"fullpage"),THIS[this.hash].prevElementParent.insertBefore(this.element,THIS[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(n.removeChild(this.toolbar.element),$.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=THIS[this.hash].prevElementWidth,this.element.style.height=THIS[this.hash].prevElementHeight;var l=0,c=function(){$.setPageScroll(s.pageScroll);var e=$.getPageScroll();l++,(10>l&&e.x!==s.pageScroll.x||e.y!==s.pageScroll.y)&&$.requestAnimationFrame(c)};$.requestAnimationFrame(c),THIS[this.hash].fullPage=!1,$.delegate(this,onContainerExit)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:e}),this},setFullScreen:function(e){var t=this;if(!$.supportsFullScreen)return this.setFullPage(e);if($.isFullScreen()===e)return this;var i={fullScreen:e,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),i.preventDefaultAction)return this;if(e){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var n=function(){var e=$.isFullScreen();e||($.removeEvent(document,$.fullScreenEventName,n),$.removeEvent(document,$.fullScreenErrorEventName,n),t.setFullPage(!1),t.isFullPage()&&(t.element.style.width=t.fullPageStyleWidth,t.element.style.height=t.fullPageStyleHeight)),t.navigator&&t.viewport&&t.navigator.update(t.viewport),t.raiseEvent("full-screen",{fullScreen:e})};$.addEvent(document,$.fullScreenEventName,n),$.addEvent(document,$.fullScreenErrorEventName,n),$.requestFullScreen(document.body)}else $.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addLayer:function(e){function t(e){i.raiseEvent("add-layer-failed",e)}var i=this,n=e.tileSource;if(!this.isOpen())throw new Error("An image must be loaded before adding layers.");if(!n)throw new Error("No tile source provided as new layer.");if(this.collectionMode)throw new Error("Layers not supported in collection mode.");return getTileSourceImplementation(this,n,function(n){if(n instanceof Array)return void t({message:"Sequences can not be added as layers.",source:n,options:e});for(var o=0;o<i.drawers.length;o++){var r=i.drawers[o].source.aspectRatio,s=r-n.aspectRatio;if(Math.abs(s)>i.layersAspectRatioEpsilon)return void t({message:"Aspect ratio mismatch with layer "+o+".",source:n,options:e})}var a=new $.Drawer({viewer:i,source:n,viewport:i.viewport,element:i.drawersContainer,opacity:void 0!==e.opacity?e.opacity:i.opacity,maxImageCacheCount:i.maxImageCacheCount,imageLoaderLimit:i.imageLoaderLimit,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,timeout:i.timeout,debugMode:i.debugMode,debugGridColor:i.debugGridColor});i.drawers.push(a),void 0!==e.level&&i.setLayerLevel(a,e.level),THIS[i.hash].forceRedraw=!0,i.raiseEvent("add-layer",{options:e,drawer:a})},function(i){i.options=e,t(i)}),this},getLayerAtLevel:function(e){if(e>=this.drawers.length)throw new Error("Level bigger than number of layers.");return this.drawers[e]},getLevelOfLayer:function(e){return $.indexOf(this.drawers,e)},getLayersCount:function(){return this.drawers.length},setLayerLevel:function(e,t){var i=this.getLevelOfLayer(e);if(t>=this.drawers.length)throw new Error("Level bigger than number of layers.");if(t===i||-1===i)return this;if(0===t||0===i){if(THIS[this.hash].sequenced)throw new Error("Cannot reassign base level when in sequence mode.");this.drawer=0===t?e:this.getLayerAtLevel(t),this.source=this.drawer.source}if(this.drawers.splice(i,1),this.drawers.splice(t,0,e),this.drawersContainer.removeChild(e.canvas),0===t){var n=this.drawers[1].canvas;n.parentNode.insertBefore(e.canvas,n)}else{var o=this.drawers[t-1].canvas;o.parentNode.insertBefore(e.canvas,o.nextSibling)}return this.raiseEvent("layer-level-changed",{drawer:e,previousLevel:i,newLevel:t}),this},removeLayer:function(e){var t=this.drawers.indexOf(e);if(-1===t)return this;if(0===t){if(THIS[this.hash].sequenced)throw new Error("Cannot remove base layer when in sequence mode.");if(1===this.drawers.length)return this.close(),this;this.drawer=this.drawers[1]}return this.drawers.splice(t,1),this.drawersContainer.removeChild(e.canvas),this.raiseEvent("remove-layer",{drawer:e}),this},forceRedraw:function(){return THIS[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var e=$.delegate(this,onFocus),t=$.delegate(this,onBlur),i=$.delegate(this,onNext),n=$.delegate(this,onPrevious),o=this.navImages,r=!0;return this.showSequenceControl&&THIS[this.hash].sequenced&&((this.previousButton||this.nextButton)&&(r=!1),this.previousButton=new $.Button({element:this.previousButton?$.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,o.previous.REST),srcGroup:resolveUrl(this.prefixUrl,o.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,o.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,o.previous.DOWN),onRelease:n,onFocus:e,onBlur:t}),this.nextButton=new $.Button({element:this.nextButton?$.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,o.next.REST),srcGroup:resolveUrl(this.prefixUrl,o.next.GROUP),srcHover:resolveUrl(this.prefixUrl,o.next.HOVER),srcDown:resolveUrl(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:e,onBlur:t}),this.navPrevNextWrap||this.previousButton.disable(),r&&(this.paging=new $.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:$.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||$.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var e=$.delegate(this,beginZoomingIn),t=$.delegate(this,endZooming),i=$.delegate(this,doSingleZoomIn),n=$.delegate(this,beginZoomingOut),o=$.delegate(this,doSingleZoomOut),r=$.delegate(this,onHome),s=$.delegate(this,onFullScreen),a=$.delegate(this,onRotateLeft),l=$.delegate(this,onRotateRight),c=$.delegate(this,onFocus),h=$.delegate(this,onBlur),u=this.navImages,d=[],p=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(p=!1),this.showZoomControl&&(d.push(this.zoomInButton=new $.Button({element:this.zoomInButton?$.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,u.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,u.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,u.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,u.zoomIn.DOWN),onPress:e,onRelease:t,onClick:i,onEnter:e,onExit:t,onFocus:c,onBlur:h})),d.push(this.zoomOutButton=new $.Button({element:this.zoomOutButton?$.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,u.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,u.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,u.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,u.zoomOut.DOWN),onPress:n,onRelease:t,onClick:o,onEnter:n,onExit:t,onFocus:c,onBlur:h}))),this.showHomeControl&&d.push(this.homeButton=new $.Button({element:this.homeButton?$.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,u.home.REST),srcGroup:resolveUrl(this.prefixUrl,u.home.GROUP),srcHover:resolveUrl(this.prefixUrl,u.home.HOVER),srcDown:resolveUrl(this.prefixUrl,u.home.DOWN),onRelease:r,onFocus:c,onBlur:h})),this.showFullPageControl&&d.push(this.fullPageButton=new $.Button({element:this.fullPageButton?$.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,u.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,u.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,u.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,u.fullpage.DOWN),onRelease:s,onFocus:c,onBlur:h})),this.showRotationControl&&(d.push(this.rotateLeftButton=new $.Button({element:this.rotateLeftButton?$.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateLeft"),srcRest:resolveUrl(this.prefixUrl,u.rotateleft.REST),srcGroup:resolveUrl(this.prefixUrl,u.rotateleft.GROUP),srcHover:resolveUrl(this.prefixUrl,u.rotateleft.HOVER),srcDown:resolveUrl(this.prefixUrl,u.rotateleft.DOWN),onRelease:a,onFocus:c,onBlur:h})),d.push(this.rotateRightButton=new $.Button({element:this.rotateRightButton?$.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:$.getString("Tooltips.RotateRight"),srcRest:resolveUrl(this.prefixUrl,u.rotateright.REST),srcGroup:resolveUrl(this.prefixUrl,u.rotateright.GROUP),srcHover:resolveUrl(this.prefixUrl,u.rotateright.HOVER),srcDown:resolveUrl(this.prefixUrl,u.rotateright.DOWN),onRelease:l,onFocus:c,onBlur:h}))),p&&(this.buttons=new $.ButtonGroup({buttons:d,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",$.delegate(this,lightUp)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:$.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||$.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return THIS[this.hash].sequence},goToPage:function(e){return e>=0&&e<this.tileSources.length&&(this.raiseEvent("page",{page:e}),THIS[this.hash].sequence=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e)),this},addOverlay:function(e,t,i,n){var o;return o=$.isPlainObject(e)?e:{element:e,location:t,placement:i,onDraw:n},e=$.getElement(o.element),getOverlayIndex(this.currentOverlays,e)>=0?this:(this.currentOverlays.push(getOverlayObject(this,o)),THIS[this.hash].forceRedraw=!0,this.raiseEvent("add-overlay",{element:e,location:o.location,placement:o.placement}),this)},updateOverlay:function(e,t,i){var n;return e=$.getElement(e),n=getOverlayIndex(this.currentOverlays,e),n>=0&&(this.currentOverlays[n].update(t,i),THIS[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:t,placement:i})),this},removeOverlay:function(e){var t;return e=$.getElement(e),t=getOverlayIndex(this.currentOverlays,e),t>=0&&(this.currentOverlays[t].destroy(),this.currentOverlays.splice(t,1),THIS[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return THIS[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources.length-1===e?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=$.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=$.makeCenteredNode(t),$.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}}})}(OpenSeadragon),function(e){function t(e){e.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(e.position).rotate(-this.viewer.viewport.degrees,this.viewer.viewport.getHomeBounds().getCenter())),this.viewer.viewport.applyConstraints())}function i(e){this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)))}function n(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function r(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}e.Navigator=function(s){var a,l,c=s.viewer,h=this;s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),s.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:!0},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",s=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize}),s.minPixelRatio=this.minPixelRatio=c.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor!=e.ControlAnchor.NONE&&!function(e,t){e.margin="0px",e.border=t+"px solid #555",e.padding="0px",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.background="transparent",e["float"]="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",c.addControl(this.element,s.controlOptions),s.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=e.ControlAnchor.NONE&&(s.width&&s.height?(this.element.style.height="number"==typeof s.height?s.height+"px":s.height,this.element.style.width="number"==typeof s.width?s.width+"px":s.width):(a=e.getElementSize(c.element),this.element.style.height=Math.round(a.y*s.sizeRatio)+"px",this.element.style.width=Math.round(a.x*s.sizeRatio)+"px",this.oldViewerSize=a),l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate&&s.viewer.addHandler("rotate",function(e){r(h.displayRegionContainer,e.degrees),r(h.displayRegion,-e.degrees),h.viewport.setRotation(e.degrees)}),this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,o)})},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);if(!t.equals(this.oldContainerSize)){var i=this.viewport.getBounds(),n=this.viewport.getCenter();this.viewport.resize(t,!0);var o=1/this.source.aspectRatio,r=i.width<=1?i.width:1,s=i.height<=o?i.height:o,a=new e.Rect(n.x-r/2,n.y-s/2,r,s);this.viewport.fitBounds(a,!0),this.oldContainerSize=t,this.drawer.update()}}},update:function(t){var i,n,o,r,s,a;i=e.getElementSize(this.viewer.element),i.equals(this.oldViewerSize)||(this.oldViewerSize=i,this.maintainSizeRatio?(n=i.x*this.sizeRatio,o=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),o=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(o)+"px",this.updateSize()),t&&this.viewport&&(r=t.getBounds(!0),s=this.viewport.pixelFromPoint(r.getTopLeft(),!1),a=this.viewport.pixelFromPoint(r.getBottomRight(),!1).minus(this.totalBorderWidths),function(e){e.top=Math.round(s.y)+"px",e.left=Math.round(s.x)+"px";var t=Math.abs(s.x-a.x),i=Math.abs(s.y-a.y);e.width=Math.round(Math.max(t,0))+"px",e.height=Math.round(Math.max(i,0))+"px"}(this.displayRegion.style))},open:function(t){this.updateSize();var i=this.viewer.viewport.containerSize.times(this.sizeRatio),n=t.getTileSize(t.maxLevel);return this.minPixelRatio=n>i.x||n>i.y?Math.min(i.x,i.y)/n:this.viewer.minPixelRatio,e.Viewer.prototype.open.apply(this,[t])}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};e.extend(e,{getString:function(i){var n,o=i.split("."),r=null,s=arguments,a=t;for(n=0;n<o.length-1;n++)a=a[o[n]]||{};return r=a[o[n]],"string"!=typeof r&&(e.console.debug("Untranslated source string:",i),r=""),r.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<s.length?s[t]:""})},setString:function(e,i){var n,o=e.split("."),r=t;for(n=0;n<o.length-1;n++)r[o[n]]||(r[o[n]]={}),r=r[o[n]];r[o[n]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n=t*Math.PI/180,o=Math.cos(n)*(this.x-i.x)-Math.sin(n)*(this.y-i.y)+i.x,r=Math.sin(n)*(this.x-i.x)+Math.cos(n)*(this.y-i.y)+i.y;return new e.Point(o,r)},toString:function(){return"("+Math.round(this.x)+","+Math.round(this.y)+")"}}}(OpenSeadragon),function($){function processResponse(xhr){var responseText=xhr.responseText,status=xhr.status,statusText,data;if(!xhr)throw new Error($.getString("Errors.Security"));if(200!==xhr.status&&0!==xhr.status)throw status=xhr.status,statusText=404==status?"Not Found":xhr.statusText,new Error($.getString("Errors.Status",status,statusText));if(responseText.match(/\s*<.*/))try{data=xhr.responseXML&&xhr.responseXML.documentElement?xhr.responseXML:$.parseXml(responseText)}catch(e){data=xhr.responseText}else data=responseText.match(/\s*[\{\[].*/)?eval("("+responseText+")"):responseText;return data}$.TileSource=function(e){var t,i,n=null,o=arguments;for(t=$.isPlainObject(e)?e:{width:o[0],height:o[1],
tileSize:o[2],tileOverlap:o[3],minLevel:o[4],maxLevel:o[5]},$.EventSource.call(this),$.extend(!0,this,t),i=0;i<arguments.length;i++)if($.isFunction(arguments[i])){n=arguments[i],this.addHandler("ready",function(e){n(e)});break}"string"==$.type(arguments[0])?(this.aspectRatio=1,this.dimensions=new $.Point(10,10),this.tileSize=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(arguments[0])):(this.ready=!0,this.aspectRatio=t.width&&t.height?t.width/t.height:1,this.dimensions=new $.Point(t.width,t.height),this.tileSize=t.tileSize?t.tileSize:0,this.tileOverlap=t.tileOverlap?t.tileOverlap:0,this.minLevel=t.minLevel?t.minLevel:0,this.maxLevel=void 0!==t.maxLevel&&null!==t.maxLevel?t.maxLevel:t.width&&t.height?Math.ceil(Math.log(Math.max(t.width,t.height))/Math.log(2)):0,n&&$.isFunction(n)&&n(this))},$.TileSource.prototype={getTileSize:function(){return this.tileSize},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(e){var t=this.getLevelScale(e),i=Math.ceil(t*this.dimensions.x/this.getTileSize(e)),n=Math.ceil(t*this.dimensions.y/this.getTileSize(e));return new $.Point(i,n)},getPixelRatio:function(e){var t=this.dimensions.times(this.getLevelScale(e)),i=1/t.x,n=1/t.y;return new $.Point(i,n)},getClosestLevel:function(e){var t,i,n;for(t=this.minLevel;t<this.maxLevel&&(n=this.getNumTiles(t),i=Math.floor(Math.max(e.x,e.y)/this.getTileSize(t)),!(Math.max(n.x,n.y)+1>=i));t++);return Math.max(0,t-1)},getTileAtPoint:function(e,t){var i=t.times(this.dimensions.x).times(this.getLevelScale(e)),n=Math.floor(i.x/this.getTileSize(e)),o=Math.floor(i.y/this.getTileSize(e));return new $.Point(n,o)},getTileBounds:function(e,t,i){var n=this.dimensions.times(this.getLevelScale(e)),o=this.getTileSize(e),r=0===t?0:o*t-this.tileOverlap,s=0===i?0:o*i-this.tileOverlap,a=o+(0===t?1:2)*this.tileOverlap,l=o+(0===i?1:2)*this.tileOverlap,c=1/n.x;return a=Math.min(a,n.x-r),l=Math.min(l,n.y-s),new $.Rect(r*c,s*c,a*c,l*c)},getImageInfo:function(e){var t,i,n,o,r,s,a,l=this;e&&(r=e.split("/"),s=r[r.length-1],a=s.lastIndexOf("."),a>-1&&(r[r.length-1]=s.slice(0,a))),i=function(t){"string"==typeof t&&(t=$.parseXml(t));var i=$.TileSource.determineType(l,t,e);return i?(o=i.prototype.configure.apply(l,[t,e]),n=new i(o),l.ready=!0,void l.raiseEvent("ready",{tileSource:n})):void l.raiseEvent("open-failed",{message:"Unable to load TileSource",source:e})},e.match(/\.js$/)?(t=e.split("/").pop().replace(".js",""),$.jsonp({url:e,async:!1,callbackName:t,callback:i})):$.makeAjaxRequest(e,function(e){var t=processResponse(e);i(t)},function(t,i){var n;try{n="HTTP "+t.status+" attempting to load TileSource"}catch(o){var r;r="undefined"!=typeof i&&i.toString?i.toString():"Unknown error",n=r+" attempting to load TileSource"}l.raiseEvent("open-failed",{message:n,source:e})})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}},$.extend(!0,$.TileSource.prototype,$.EventSource.prototype),$.TileSource.determineType=function(e,t,i){var n;for(n in OpenSeadragon)if(n.match(/.+TileSource$/)&&$.isFunction(OpenSeadragon[n])&&$.isFunction(OpenSeadragon[n].prototype.supports)&&OpenSeadragon[n].prototype.supports.call(e,t,i))return OpenSeadragon[n];$.console.error("No TileSource was able to open %s %s",i,t)}}(OpenSeadragon),function(e){function t(t,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var o,r,s,a,l,c=n.documentElement,h=c.localName||c.tagName,u=n.documentElement.namespaceURI,d=null,p=[];if("Image"==h)try{if(a=c.getElementsByTagName("Size")[0],void 0===a&&(a=c.getElementsByTagNameNS(u,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:c.getAttribute("Url"),Format:c.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(c.getAttribute("Overlap"),10),TileSize:parseInt(c.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(o=c.getElementsByTagName("DisplayRect"),void 0===o&&(o=c.getElementsByTagNameNS(u,"DisplayRect")[0]),l=0;l<o.length;l++)r=o[l],s=r.getElementsByTagName("Rect")[0],void 0===s&&(s=r.getElementsByTagNameNS(u,"Rect")[0]),p.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return p.length&&(d.Image.DisplayRect=p),i(t,d)}catch(m){throw m instanceof Error?m:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==h)throw new Error(e.getString("Errors.Dzc"));if("Error"==h)return e._processDZIError(c)}throw new Error(e.getString("Errors.Dzi"))}function i(t,i){var n,o,r=i.Image,s=r.Url,a=r.Format,l=r.Size,c=r.DisplayRect||[],h=parseInt(l.Width,10),u=parseInt(l.Height,10),d=parseInt(r.TileSize,10),p=parseInt(r.Overlap,10),m=[];for(o=0;o<c.length;o++)n=c[o].Rect,m.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:h,height:u,tileSize:d,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:m},i)}e.DziTileSource=function(t){var i,n,o,r;if(r=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=r.tilesUrl,this.fileFormat=r.fileFormat,this.displayRects=r.displayRects,this.displayRects)for(i=this.displayRects.length-1;i>=0;i--)for(n=this.displayRects[i],o=n.minLevel;o<=n.maxLevel;o++)this._levelRects[o]||(this._levelRects[o]=[]),this._levelRects[o].push(n);e.TileSource.apply(this,[r])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e){var t;return e.Image?t=e.Image.xmlns:e.documentElement&&("Image"==e.documentElement.localName||"Image"==e.documentElement.tagName)&&(t=e.documentElement.namespaceURI),"http://schemas.microsoft.com/deepzoom/2008"==t||"http://schemas.microsoft.com/deepzoom/2009"==t},configure:function(n,o){var r;return r=e.isPlainObject(n)?i(this,n):t(this,n),o&&!r.tilesUrl&&(r.tilesUrl=o.replace(/([^\/]+)\.(dzi|xml|js)(\?.*|$)/,"$1_files/"),r.queryParams=-1!=o.search(/\.(dzi|xml|js)\?/)?o.match(/\?.*/):""),r},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,o,r,s,a,l,c,h=this._levelRects[e];if(!h||!h.length)return!0;for(c=h.length-1;c>=0;c--)if(n=h[c],!(e<n.minLevel||e>n.maxLevel)&&(o=this.getLevelScale(e),r=n.x*o,s=n.y*o,a=r+n.width*o,l=s+n.height*o,r=Math.floor(r/this.tileSize),s=Math.floor(s/this.tileSize),a=Math.ceil(a/this.tileSize),l=Math.ceil(l/this.tileSize),t>=r&&a>t&&i>=s&&l>i))return!0;return!1}})}(OpenSeadragon),function(e){function t(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var n=t.documentElement,o=n.tagName,r=null;if("info"==o)try{return r={},i(n,r),r}catch(s){throw s instanceof Error?s:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}function i(t,n,o){var r,s;if(3==t.nodeType&&o)s=t.nodeValue.trim(),s.match(/^\d*$/)&&(s=Number(s)),n[o]?(e.isArray(n[o])||(n[o]=[n[o]]),n[o].push(s)):n[o]=s;else if(1==t.nodeType)for(r=0;r<t.childNodes.length;r++)i(t.childNodes[r],n,t.nodeName)}e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(t.tileSizePerScaleFactor={},this.tile_width)t.tileSize=this.tile_width;else if(this.tile_height)t.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)t.tileSize=this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var i=0;i<this.tiles.length;i++)for(var n=0;n<this.tiles[i].scaleFactors.length;n++){var o=this.tiles[i].scaleFactors[n];this.scale_factors.push(o),t.tileSizePerScaleFactor[o]=this.tiles[i].width}}else{for(var r=Math.min(this.height,this.width),s=[256,512,1024],a=[],l=0;l<s.length;l++)s[l]<=r&&a.push(s[l]);t.tileSize=a.length>0?Math.max.apply(null,a):r,this.tile_width=t.tileSize,this.tile_height=t.tileSize}t.maxLevel||(t.maxLevel=this.scale_factors?Math.floor(Math.pow(Math.max.apply(null,this.scale_factors),.5)):Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))),e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.protocol&&"http://iiif.io/api/image"==e.protocol?!0:!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=e["@context"]&&"http://iiif.io/api/image/1/context.json"!=e["@context"]?e.profile&&0===e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")?!0:e.identifier&&e.width&&e.height?!0:e.documentElement&&"info"==e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==e.documentElement.namespaceURI?!0:!1:!0},configure:function(i,n){if(e.isPlainObject(i))return i["@context"]?i:(i["@context"]="http://iiif.io/api/image/1.0/context.json",i["@id"]=n.replace("/info.json",""),i);var o=t(i);return o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=n.replace("/info.xml",""),o},getTileSize:function(e){var t=Math.pow(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[t]&&(this.tileSize=this.tileSizePerScaleFactor[t]),this.tileSize},getTileUrl:function(e,t,i){var n,o,r,s,a,l,c,h,u,d,p="0",m=Math.pow(.5,this.maxLevel-e),g=Math.ceil(this.width*m),v=Math.ceil(this.height*m);return n=Math.ceil(this.getTileSize(e)/m),o=n,u=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",g<this.tile_width&&v<this.tile_height?(h=g+",",r="full"):(s=t*n,a=i*o,l=Math.min(n,this.width-s),c=Math.min(o,this.height-a),h=Math.ceil(l*m)+",",r=[s,a,l,c].join(",")),d=[this["@id"],r,h,p,u].join("/")}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},i.width&&i.height||(i.width=65572864,i.height=65572864),i.tileSize||(i.tileSize=256,i.tileOverlap=0),i.tilesUrl||(i.tilesUrl="http://tile.openstreetmap.org/"),i.minLevel=8,e.TileSource.apply(this,[i])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var n,o=256*Math.ceil(i.width/256),r=256*Math.ceil(i.height/256);n=o>r?o/256:r/256,i.maxLevel=Math.ceil(Math.log(n)/Math.log(2))-1,i.tileSize=256,i.width=o,i.height=r,e.TileSource.apply(this,[i])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){function t(t){var i,n,o=[];for(n=0;n<t.length;n++)i=t[n],i.height&&i.width&&i.url&&(i.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)||i.mimetype&&i.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))?o.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return o.sort(function(e,t){return e.height-t.height})}function i(t,i){if(!i||!i.documentElement)throw new Error(e.getString("Errors.Xml"));var o,r,s=i.documentElement,a=s.tagName,l=null,c=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},c=s.getElementsByTagName("level"),r=0;r<c.length;r++)o=c[r],l.levels.push({url:o.getAttribute("url"),width:parseInt(o.getAttribute("width"),10),height:parseInt(o.getAttribute("height"),10)});return n(t,l)}catch(h){throw h instanceof Error?h:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+i)}throw new Error("Unknown element "+a)}function n(e,t){return t.levels}e.LegacyTileSource=function(i){var n,o,r;e.isArray(i)&&(n={type:"legacy-image-pyramid",levels:i}),n.levels=t(n.levels),n.levels.length>0?(o=n.levels[n.levels.length-1].width,r=n.levels[n.levels.length-1].height):(o=0,r=0,e.console.error("No supported image formats found")),e.extend(!0,n,{width:o,height:r,tileSize:Math.max(r,o),tileOverlap:0,minLevel:0,maxLevel:n.levels.length>0?n.levels.length-1:0}),e.TileSource.apply(this,[n]),this.levels=n.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(t){var o;return o=e.isPlainObject(t)?n(this,t):i(this,t)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){var i=this.getLevelScale(t);return i?new e.Point(1,1):new e.Point(0,0)},getTileAtPoint:function(){return new e.Point(0,0)},getTileUrl:function(e){var t=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].url),t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t){var i;i=e.isPlainObject(t)?t:{tileSize:arguments[0],tileSources:arguments[1],rows:arguments[2],layout:arguments[3]},i.layout||(i.layout="horizontal");var n=0,o=1,r=Math.ceil(i.tileSources.length/i.rows),s=r>=i.rows?r:i.rows;for("horizontal"==i.layout?(i.width=i.tileSize*r,i.height=i.tileSize*i.rows):(i.height=i.tileSize*r,i.width=i.tileSize*i.rows),i.tileOverlap=-i.tileMargin,i.tilesPerRow=r;o<i.tileSize*s;)o=2*o,n++;i.minLevel=n,e.TileSource.apply(this,[i])},e.extend(e.TileSourceCollection.prototype,e.TileSource.prototype,{getTileBounds:function(t,i,n){var o=this.dimensions.times(this.getLevelScale(t)),r=this.tileSize*i-this.tileOverlap,s=this.tileSize*n-this.tileOverlap,a=this.tileSize+1*this.tileOverlap,l=this.tileSize+1*this.tileOverlap,c=1/o.x;return a=Math.min(a,o.x-r),l=Math.min(l,o.y-s),new e.Rect(r*c,s*c,a*c,l*c)},configure:function(){},getTileUrl:function(){return null}})}(OpenSeadragon),function(e){function t(t){e.requestAnimationFrame(function(){i(t)})}function i(i){var n,o,r;i.shouldFade&&(n=e.now(),o=n-i.fadeBeginTime,r=1-o/i.fadeLength,r=Math.min(1,r),r=Math.max(0,r),i.imgGroup&&e.setElementOpacity(i.imgGroup,r,!0),r>0&&t(i))}function n(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout(function(){t(i)},i.fadeDelay)}function o(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}function r(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(o(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function s(t,i){t.element.disabled||(i<=e.ButtonState.HOVER&&t.currentState==e.ButtonState.DOWN&&(t.imgDown&&(t.imgDown.style.visibility="hidden"),t.currentState=e.ButtonState.HOVER),i<=e.ButtonState.GROUP&&t.currentState==e.ButtonState.HOVER&&(t.imgHover&&(t.imgHover.style.visibility="hidden"),t.currentState=e.ButtonState.GROUP),i<=e.ButtonState.REST&&t.currentState==e.ButtonState.GROUP&&(n(t),t.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var i=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(r(i,e.ButtonState.DOWN),i.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||r(i,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),i.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){s(i,e.ButtonState.GROUP),t.insideElementPressed&&i.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),i.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){r(i,e.ButtonState.DOWN),i.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(s(i,e.ButtonState.HOVER),i.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?s(i,e.ButtonState.GROUP):r(i,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&i.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13===e.keyCode?(i.raiseEvent("click",{originalEvent:e.originalEvent}),i.raiseEvent("release",{originalEvent:e.originalEvent}),!1):!0}}),s(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){r(this,e.ButtonState.GROUP)},notifyGroupExit:function(){s(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),o=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.label=e.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;e<o.buttons.length;e++)o.buttons[e].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<o.buttons.length;t++)o.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(e,t,i,n){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0,this.width="number"==typeof i?i:0,this.height="number"==typeof n?n:0},e.Rect.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height)},getTopRight:function(){return new e.Point(this.x+this.width,this.y)},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height)},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},times:function(e){return new OpenSeadragon.Rect(this.x*e,this.y*e,this.width*e,this.height*e)},rotate:function(t,i){var n,o=this.width,r=this.height;if(t=(t+360)%360,t%90!==0)throw new Error("Currently only 0, 90, 180, and 270 degrees are supported.");if(0===t)return new e.Rect(this.x,this.y,this.width,this.height);switch(i=i||this.getCenter(),t){case 90:n=this.getBottomLeft(),o=this.height,r=this.width;break;case 180:n=this.getBottomRight();break;case 270:n=this.getTopRight(),o=this.height,r=this.width;break;default:n=this.getTopLeft()}return n=n.rotate(t,i),new e.Rect(n.x,n.y,o,r)},toString:function(){return"["+Math.round(100*this.x)+","+Math.round(100*this.y)+","+Math.round(100*this.width)+"x"+Math.round(100*this.height)+"]"}}}(OpenSeadragon),function(e){function t(t){var i=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?i>-(r-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",n(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&0>i&&(this.element.style.marginLeft=i+2*t.delta.x+"px",n(this,a.x,i+2*t.delta.x)):-t.delta.y>0?o>-(s-a.y)&&(this.element.style.marginTop=o+2*t.delta.y+"px",n(this,a.y,o+2*t.delta.y)):-t.delta.y<0&&0>o&&(this.element.style.marginTop=o+2*t.delta.y+"px",n(this,a.y,o+2*t.delta.y))),!1}function i(t){var i=Number(this.element.style.marginLeft.replace("px","")),o=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?i>-(r-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",n(this,a.x,i-60*t.scroll)):t.scroll<0&&0>i&&(this.element.style.marginLeft=i-60*t.scroll+"px",n(this,a.x,i-60*t.scroll)):t.scroll<0?o>a.y-s&&(this.element.style.marginTop=o+60*t.scroll+"px",n(this,a.y,o+60*t.scroll)):t.scroll>0&&0>o&&(this.element.style.marginTop=o+60*t.scroll+"px",n(this,a.y,o+60*t.scroll))),!1}function n(t,i,n){var o,r,s,a,l,c,h;for(o="horizontal"==t.scroll?t.panelWidth:t.panelHeight,r=Math.ceil(i/o)+5,s=Math.ceil((Math.abs(n)+i)/o)+1,r=s-r,r=0>r?0:r,c=r;s>c&&c<t.panels.length;c++)h=t.panels[c],h.activePanel||(a=new e.Viewer({id:h.id,tileSources:[t.viewer.tileSources[c]],element:h,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),a.displayRegion=e.makeNeutralElement("textarea"),a.displayRegion.id=h.id+"-displayregion",a.displayRegion.className="displayregion",l=a.displayRegion.style,l.position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l["float"]="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion,startDisabled:!0}),h.getElementsByTagName("div")[0].appendChild(a.displayRegion),h.activePanel=!0)}function o(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function r(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px",!1}function s(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function a(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}var l={};e.ReferenceStrip=function(c){var h,u,d,p=this,m=c.viewer,g=e.getElementSize(m.element);for(c.id||(c.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=c.id,this.element.className="referencestrip"),c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},c,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,c),l[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,u=this.element.style,u.marginTop="0px",u.marginRight="0px",u.marginBottom="0px",u.marginLeft="0px",u.left="0px",u.bottom="0px",u.border="0px",u.background="#000",u.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=m,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,t),scrollHandler:e.delegate(this,i),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,r),keyDownHandler:e.delegate(this,s),keyHandler:e.delegate(this,a)}),c.width&&c.height?(this.element.style.width=c.width+"px",this.element.style.height=c.height+"px",m.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==c.scroll?(this.element.style.width=g.x*c.sizeRatio*m.tileSources.length+12*m.tileSources.length+"px",this.element.style.height=g.y*c.sizeRatio+"px",m.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=g.y*c.sizeRatio*m.tileSources.length+12*m.tileSources.length+"px",this.element.style.width=g.x*c.sizeRatio+"px",m.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=g.x*this.sizeRatio+8,this.panelHeight=g.y*this.sizeRatio+8,this.panels=[],d=0;d<m.tileSources.length;d++)h=e.makeNeutralElement("div"),h.id=this.element.id+"-"+d,h.style.width=p.panelWidth+"px",h.style.height=p.panelHeight+"px",h.style.display="inline",h.style["float"]="left",h.style.cssFloat="left",h.style.styleFloat="left",h.style.padding="2px",e.setElementTouchActionNone(h),h.innerTracker=new e.MouseTracker({element:h,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var i=t.eventSource,n=i.element.id,o=Number(n.split("-")[2]),r=e.now();t.insideElementPressed&&t.insideElementReleased&&i.dragging&&r-i.dragging<i.clickTimeThreshold&&(i.dragging=null,m.goToPage(o))}}),this.element.appendChild(h),h.activePanel=!1,this.panels.push(h);n(this,"vertical"==this.scroll?g.y:g.y,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var i,r=e.getElement(this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),c=-Number(this.element.style.marginLeft.replace("px","")),h=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==r&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=r,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3),i>c+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",n(this,s.x,-i)):c>i&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",n(this,s.x,-i))):(i=Number(t)*(this.panelHeight+3),i>h+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",n(this,s.y,-i)):h>i&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",n(this,s.y,-i))),this.currentPage=t,e.getElement(r.id+"-displayregion").focus(),o.call(this,{eventSource:this.innerTracker}))},update:function(){return l[this.id].animating?(e.console.log("image reference strip update"),!0):!1}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,o,r,s){e.Rect.apply(this,[t,i,n,o]),this.minLevel=r,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){function t(e,t){return(1-Math.exp(e*-t))/(1-Math.exp(-e))}e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:0,time:e.now()},this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time}},e.Spring.prototype={resetTo:function(e){this.target.value=e,this.target.time=this.current.time,this.start.value=this.target.value,this.start.time=this.target.time},springTo:function(e){this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=e,this.target.time=this.start.time+1e3*this.animationTime},shiftBy:function(e){this.start.value+=e,this.target.value+=e},update:function(){this.current.time=e.now(),this.current.value=this.current.time>=this.target.time?this.target.value:this.start.value+(this.target.value-this.start.value)*t(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time))}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}function i(e,t,i){var n;e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(n=e.jobQueue.shift(),n.start()),i(t.image)}t.prototype={start:function(){var e=this;this.image=new Image,this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.onload=function(){e.finish(!0)},this.image.onabort=this.image.onerror=function(){e.finish(!1)},this.jobId=window.setTimeout(function(){e.finish(!1)},this.timeout),this.image.src=this.src},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,jobQueue:[],
jobsInProgress:0})},e.ImageLoader.prototype={addJob:function(e){var n=this,o=function(t){i(n,t,e.callback)},r={src:e.src,crossOriginPolicy:e.crossOriginPolicy,callback:o},s=new t(r);!this.jobLimit||this.jobsInProgress<this.jobLimit?(s.start(),this.jobsInProgress++):this.jobQueue.push(s)},clear:function(){this.jobQueue=[]}}}(OpenSeadragon),function(e){var t={};e.Tile=function(e,t,i,n,o,r){this.level=e,this.x=t,this.y=i,this.bounds=n,this.exists=o,this.url=r,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(t){return this.loaded&&this.image?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=e.makeNeutralElement("img"),this.imgElement.src=this.url,this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",void e.setElementOpacity(this.element,this.opacity)):void e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())},drawCanvas:function(i,n){var o,r,s=this.position,a=this.size;return this.loaded&&(this.image||t[this.url])?(i.globalAlpha=this.opacity,1==i.globalAlpha&&this.url.match(".png")&&i.clearRect(s.x+1,s.y+1,a.x-2,a.y-2),t[this.url]||(r=document.createElement("canvas"),r.width=this.image.width,r.height=this.image.height,o=r.getContext("2d"),o.drawImage(this.image,0,0),t[this.url]=o,this.image=null),o=t[this.url],n({context:i,tile:this,rendered:o}),void i.drawImage(o.canvas,0,0,o.canvas.width,o.canvas.height,s.x,s.y,a.x,a.y)):void e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),t[this.url]&&delete t[this.url],this.element=null,this.imgElement=null,this.image=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8},e.Overlay=function(t,i,n){var o;o=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=o.element,this.scales=o.location instanceof e.Rect,this.bounds=new e.Rect(o.location.x,o.location.y,o.location.width,o.location.height),this.position=new e.Point(o.location.x,o.location.y),this.size=new e.Point(o.location.width,o.location.height),this.style=o.element.style,this.placement=o.location instanceof e.Point?o.placement:e.OverlayPlacement.TOP_LEFT,this.onDraw=o.onDraw,this.checkResize=void 0===o.checkResize?!0:o.checkResize},e.Overlay.prototype={adjust:function(t,i){switch(this.placement){case e.OverlayPlacement.TOP_LEFT:break;case e.OverlayPlacement.TOP:t.x-=i.x/2;break;case e.OverlayPlacement.TOP_RIGHT:t.x-=i.x;break;case e.OverlayPlacement.RIGHT:t.x-=i.x,t.y-=i.y/2;break;case e.OverlayPlacement.BOTTOM_RIGHT:t.x-=i.x,t.y-=i.y;break;case e.OverlayPlacement.BOTTOM:t.x-=i.x/2,t.y-=i.y;break;case e.OverlayPlacement.BOTTOM_LEFT:t.y-=i.y;break;case e.OverlayPlacement.LEFT:t.y-=i.y/2;break;default:case e.OverlayPlacement.CENTER:t.x-=i.x/2,t.y-=i.y/2}},destroy:function(){var e=this.element,t=this.style;e.parentNode&&(e.parentNode.removeChild(e),e.prevElementParent&&(t.display="none",document.body.appendChild(e))),this.onDraw=null,t.top="",t.left="",t.position="",this.scales&&(t.width="",t.height="")},drawHTML:function(t,i){var n,o,r=this.element,s=this.style,a=this.scales,l=i.degrees,c=i.pixelFromPoint(this.bounds.getTopLeft(),!0);if(r.parentNode!=t&&(r.prevElementParent=r.parentNode,r.prevNextSibling=r.nextSibling,t.appendChild(r),this.size=e.getElementSize(r)),n=a?i.deltaPixelsFromPoints(this.bounds.getSize(),!0):this.checkResize?e.getElementSize(r):this.size,this.position=c,this.size=n,this.adjust(c,n),c=c.apply(Math.floor),n=n.apply(Math.ceil),0!==l&&this.scales){o=new e.Point(n.x/2,n.y/2);var h=new e.Point(i.viewer.drawer.canvas.width/2,i.viewer.drawer.canvas.height/2);c=c.plus(o).rotate(l,h).minus(o),n=n.rotate(l,new e.Point(0,0)),n=new e.Point(Math.abs(n.x),Math.abs(n.y))}this.onDraw?this.onDraw(c,n,r):(s.left=c.x+"px",s.top=c.y+"px",s.position="absolute",s.display="block",a&&(s.width=n.x+"px",s.height=n.y+"px"))},update:function(t,i){this.scales=t instanceof e.Rect,this.bounds=new e.Rect(t.x,t.y,t.width,t.height),this.placement=t instanceof e.Point?i:e.OverlayPlacement.TOP_LEFT}}}(OpenSeadragon),function(e){function t(t){t.updateAgain=!1,t.viewer&&t.viewer.raiseEvent("update-viewport",{});for(var n,o,s,a,l,c,h,d,p=null,m=!1,g=e.now(),f=t.viewport.getContainerSize(),y=t.viewport.getBounds(!0),w=y.getTopLeft(),T=y.getBottomRight(),S=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(0),!0).x,E=Math.max(t.source.minLevel,Math.floor(Math.log(t.minZoomImageRatio)/Math.log(2))),x=Math.min(Math.abs(t.source.maxLevel),Math.abs(Math.floor(Math.log(S/t.minPixelRatio)/Math.log(2)))),P=t.viewport.degrees;t.lastDrawn.length>0;)n=t.lastDrawn.pop(),n.beingDrawn=!1;if(t.canvas.innerHTML="",t.useCanvas&&((t.canvas.width!=f.x||t.canvas.height!=f.y)&&(t.canvas.width=f.x,t.canvas.height=f.y),t.context.clearRect(0,0,f.x,f.y)),90===P||270===P){var b=y.rotate(P);w=b.getTopLeft(),T=b.getBottomRight()}else if(0!==P){var R=y.rotate(90);y.x-=R.width/2,y.y-=R.height/2,y.width+=R.width,y.height+=R.height,w=y.getTopLeft(),T=y.getBottomRight()}if(!(!t.wrapHorizontal&&(T.x<0||w.x>1)||!t.wrapVertical&&(T.y<0||w.y>t.normHeight))){t.wrapHorizontal||(w.x=Math.max(w.x,0),T.x=Math.min(T.x,1)),t.wrapVertical||(w.y=Math.max(w.y,0),T.y=Math.min(T.y,t.normHeight)),E=Math.min(E,x);var k;for(o=x;o>=E;o--){if(k=!1,s=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(o),!0).x,!m&&s>=t.minPixelRatio||o==E)k=!0,m=!0;else if(!m)continue;if(a=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(o),!1).x,l=t.viewport.deltaPixelsFromPoints(t.source.getPixelRatio(Math.max(t.source.getClosestLevel(t.viewport.containerSize)-1,0)),!1).x,c=t.immediateRender?1:l,h=Math.min(1,(s-.5)/.5),d=c/Math.abs(c-a),p=i(t,m,k,o,h,d,w,T,g,p),u(t.coverage,o))break}v(t,t.lastDrawn),p&&(r(t,p,g),t.updateAgain=!0)}}function i(e,t,i,o,r,s,a,l,c,h){var u,d,p,g,v,f=e.viewport.pixelFromPoint(e.viewport.getCenter());for(e.viewer&&e.viewer.raiseEvent("update-level",{havedrawn:t,level:o,opacity:r,visibility:s,topleft:a,bottomright:l,currenttime:c,best:h}),p=e.source.getTileAtPoint(o,a),g=e.source.getTileAtPoint(o,l),v=e.source.getNumTiles(o),m(e.coverage,o),e.wrapHorizontal||(g.x=Math.min(g.x,v.x-1)),e.wrapVertical||(g.y=Math.min(g.y,v.y-1)),u=p.x;u<=g.x;u++)for(d=p.y;d<=g.y;d++)h=n(e,i,t,u,d,o,r,s,f,v,c,h);return h}function n(e,t,i,n,r,s,a,h,u,m,v,f){var y=o(n,r,s,e.source,e.tilesMatrix,v,m,e.normHeight),w=t;if(e.viewer&&e.viewer.raiseEvent("update-tile",{tile:y}),p(e.coverage,s,n,r,!1),!y.exists)return f;if(i&&!w&&(d(e.coverage,s,n,r)?p(e.coverage,s,n,r,!0):w=!0),!w)return f;if(l(y,e.source.tileOverlap,e.viewport,u,h),y.loaded){var T=c(e,y,n,r,s,a,v);T&&(e.updateAgain=!0)}else y.loading||(f=g(f,y));return f}function o(t,i,n,o,r,s,a,l){var c,h,u,d,p,m;return r[n]||(r[n]={}),r[n][t]||(r[n][t]={}),r[n][t][i]||(c=(a.x+t%a.x)%a.x,h=(a.y+i%a.y)%a.y,u=o.getTileBounds(n,c,h),d=o.tileExists(n,c,h),p=o.getTileUrl(n,c,h),u.x+=1*(t-c)/a.x,u.y+=l*(i-h)/a.y,r[n][t][i]=new e.Tile(n,t,i,u,d,p)),m=r[n][t][i],m.lastTouchTime=s,m}function r(e,t,i){e.viewport.collectionMode?(e.midUpdate=!1,s(e,t,i)):(t.loading=!0,e.imageLoader.addJob({src:t.url,crossOriginPolicy:e.crossOriginPolicy,callback:function(n){s(e,t,i,n)}}))}function s(t,i,n,o){if(i.loading=!1,o||t.viewport.collectionMode){if(n<t.lastResetTime)return void e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url)}else if(e.console.log("Tile %s failed to load: %s",i,i.url),!t.debugMode)return void(i.exists=!1);i.loaded=!0,i.image=o,t.tilesLoaded.length<t.maxImageCacheCount?t.tilesLoaded[t.tilesLoaded.length]=i:t.midUpdate?window.setTimeout(function(){a(i,t)},1):a(i,t),t.updateAgain=!0}function a(e,t){var i,n,o,r,s,a,l=t.tilesLoaded.length,c=(Math.ceil(Math.log(t.source.getTileSize(e.level))/Math.log(2)),null),h=-1;for(i=t.tilesLoaded.length-1;i>=0;i--)n=t.tilesLoaded[i],n.level<=t.cutoff||n.beingDrawn||(c?(o=n.lastTouchTime,r=c.lastTouchTime,s=n.level,a=c.level,(r>o||o==r&&s>a)&&(c=n,h=i)):(c=n,h=i));c&&h>=0&&(c.unload(),l=h),t.tilesLoaded[l]=e}function l(t,i,n,o,r){var s=t.bounds.getTopLeft(),a=t.bounds.getSize(),l=n.pixelFromPoint(s,!0),c=n.pixelFromPoint(s,!1),h=n.deltaPixelsFromPoints(a,!0),u=n.deltaPixelsFromPoints(a,!1),d=c.plus(u.divide(2)),p=o.distanceTo(d);i||(h=h.plus(new e.Point(1,1))),t.position=l,t.size=h,t.distance=p,t.visibility=r}function c(e,t,i,n,o,r,s){var a,l,c=1e3*e.blendTime;if(t.blendStart||(t.blendStart=s),a=s-t.blendStart,l=c?Math.min(1,a/c):1,e.alwaysBlend&&(l*=r),t.opacity=l,e.lastDrawn.push(t),1==l)p(e.coverage,o,i,n,!0);else if(c>a)return!0;return!1}function h(e){e.tilesMatrix={},e.tilesLoaded=[]}function u(e,t,i,n){var o,r,s,a;if(!e[t])return!1;if(void 0===i||void 0===n){o=e[t];for(s in o)if(o.hasOwnProperty(s)){r=o[s];for(a in r)if(r.hasOwnProperty(a)&&!r[a])return!1}return!0}return void 0===e[t][i]||void 0===e[t][i][n]||e[t][i][n]===!0}function d(e,t,i,n){return void 0===i||void 0===n?u(e,t+1):u(e,t+1,2*i,2*n)&&u(e,t+1,2*i,2*n+1)&&u(e,t+1,2*i+1,2*n)&&u(e,t+1,2*i+1,2*n+1)}function p(t,i,n,o,r){return t[i]?(t[i][n]||(t[i][n]={}),void(t[i][n][o]=r)):void e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function m(e,t){e[t]={}}function g(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function v(t,i){var n,o,r,s,a,l,c,h,u=function(e){t.viewer&&t.viewer.raiseEvent("tile-drawing",e)};for(n=i.length-1;n>=0;n--){if(o=i[n],t.viewport.collectionMode?(r=o.x+"/"+o.y,a=t.viewport,h=a.collectionTileSource,t.collectionOverlays[r]?(s=t.collectionOverlays[r],s.viewport&&(s.viewport.resize(o.size,!0),s.viewport.goHome(!0))):(l="horizontal"==h.layout?o.y+o.x*h.rows:o.x+o.y*h.rows,c=l<h.tileSources.length?h.tileSources[l]:null,c&&(t.collectionOverlays[r]=s=new e.Viewer({hash:a.viewer.hash+"-"+r,element:e.makeNeutralElement("div"),mouseNavEnabled:!1,showNavigator:!1,showSequenceControl:!1,showNavigationControl:!1,tileSources:[c]}),E&&(s.element.style.border="1px solid rgba(255,255,255,0.38)",s.element.style["-webkit-box-reflect"]="below 0px -webkit-gradient(linear,left top,left bottom,from(transparent),color-stop(62%,transparent),to(rgba(255,255,255,0.62)))"),t.viewer.addOverlay(s.element,o.bounds)))):(t.useCanvas?0!==t.viewport.degrees?(f(o,t.canvas,t.context,t.viewport.degrees),o.drawCanvas(t.context,u),y(o,t.canvas,t.context)):o.drawCanvas(t.context,u):o.drawHTML(t.canvas),o.beingDrawn=!0),t.debugMode)try{w(t,o,i.length,n)}catch(d){e.console.error(d)}t.viewer&&t.viewer.raiseEvent("tile-drawn",{tile:o})}}function f(e,t,i,n){var o=t.width/2,r=t.height/2,s=e.position.x-o,a=e.position.y-r;i.save(),i.translate(o,r),i.rotate(Math.PI/180*n),e.position.x=s,e.position.y=a}function y(e,t,i){var n=t.width/2,o=t.height/2,r=e.position.x+n,s=e.position.y+o;e.position.x=r,e.position.y=s,i.restore()}function w(e,t,i,n){if(e.useCanvas){e.context.save(),e.context.lineWidth=2,e.context.font="small-caps bold 13px ariel",e.context.strokeStyle=e.debugGridColor,e.context.fillStyle=e.debugGridColor,f(t,e.canvas,e.context,e.viewport.degrees),e.context.strokeRect(t.position.x,t.position.y,t.size.x,t.size.y);var o=t.position.x+t.size.x/2,r=t.position.y+t.size.y/2;e.context.translate(o,r),e.context.rotate(Math.PI/180*-e.viewport.degrees),e.context.translate(-o,-r),0===t.x&&0===t.y&&(e.context.fillText("Zoom: "+e.viewport.getZoom(),t.position.x,t.position.y-30),e.context.fillText("Pan: "+e.viewport.getBounds().toString(),t.position.x,t.position.y-20)),e.context.fillText("Level: "+t.level,t.position.x+10,t.position.y+20),e.context.fillText("Column: "+t.x,t.position.x+10,t.position.y+30),e.context.fillText("Row: "+t.y,t.position.x+10,t.position.y+40),e.context.fillText("Order: "+n+" of "+i,t.position.x+10,t.position.y+50),e.context.fillText("Size: "+t.size.toString(),t.position.x+10,t.position.y+60),e.context.fillText("Position: "+t.position.toString(),t.position.x+10,t.position.y+70),y(t,e.canvas,e.context),e.context.restore()}}var T=(e.getWindowSize(),e.Browser.vendor),S=e.Browser.version,E=T==e.BROWSERS.FIREFOX||T==e.BROWSERS.OPERA||T==e.BROWSERS.SAFARI&&S>=4||T==e.BROWSERS.CHROME&&S>=2||T==e.BROWSERS.IE&&S>=9;e.Drawer=function(t){var i=arguments;e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.extend(!0,this,{viewer:null,imageLoader:new e.ImageLoader,tilesMatrix:{},tilesLoaded:[],coverage:{},lastDrawn:[],lastResetTime:0,midUpdate:!1,updateAgain:!0,collectionOverlays:{},opacity:e.DEFAULT_SETTINGS.opacity,maxImageCacheCount:e.DEFAULT_SETTINGS.maxImageCacheCount,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,debugMode:e.DEFAULT_SETTINGS.debugMode,timeout:e.DEFAULT_SETTINGS.timeout,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy},t),this.useCanvas=e.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=e.getElement(this.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.normHeight=this.source.dimensions.y/this.source.dimensions.x,this.element=this.container,this.container.dir="ltr",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},e.Drawer.prototype={addOverlay:function(t,i,n,o){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,o),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(t){return this.opacity=t,e.setElementOpacity(this.canvas,this.opacity,!0),this},getOpacity:function(){return this.opacity},needsUpdate:function(){return this.updateAgain},numTilesLoaded:function(){return this.tilesLoaded.length},reset:function(){return h(this),this.lastResetTime=e.now(),this.updateAgain=!0,this},update:function(){return this.midUpdate=!0,t(this),this.midUpdate=!1,this},canRotate:function(){return this.useCanvas},destroy:function(){for(var e=0;e<this.tilesLoaded.length;++e)this.tilesLoaded[e].unload();this.canvas.width=1,this.canvas.height=1}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.resetContentSize(this.contentSize),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return this.contentSize=t,this.contentAspectX=this.contentSize.x/this.contentSize.y,this.contentAspectY=this.contentSize.y/this.contentSize.x,this.fitWidthBounds=new e.Rect(0,0,1,this.contentAspectY),this.fitHeightBounds=new e.Rect(0,0,this.contentAspectY,this.contentAspectY),this.homeBounds=new e.Rect(0,0,1,this.contentAspectY),this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:t}),this},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this.contentAspectX/this.getAspectRatio();return this.homeFillsViewer?e>=1?e:1:e>=1?1:e},getHomeBounds:function(){var t=this.homeBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return Math.min(t,e)},getMaxZoom:function(){var e=this.maxZoomLevel?this.maxZoomLevel:this.contentSize.x*this.maxZoomPixelRatio/this.containerSize.x;return Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this.containerSize.x/this.containerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getBounds:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),o=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-o/2,n,o)},getCenter:function(t){var i,n,o,r,s,a,l,c,h=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),u=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?h:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),n=this.getZoom(),o=1/n,r=o/this.getAspectRatio(),s=new e.Rect(h.x-o/2,h.y-r/2,o,r),a=this.zoomPoint.minus(s.getTopLeft()).times(this.containerSize.x/s.width),l=a.minus(i),c=l.divide(this.containerSize.x*n),u.plus(c)):u},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyBoundaryConstraints:function(t,i){var n,o,r,s,a,l,c=0,h=0,u=new e.Rect(t.x,t.y,t.width,t.height);return n=this.visibilityRatio*u.width,o=this.visibilityRatio*u.height,r=u.x+u.width,s=1-u.x,a=u.y+u.height,l=this.contentAspectY-u.y,this.wrapHorizontal||(n>r&&(c=n-r),n>s&&(c=c?(c+s-n)/2:s-n)),this.wrapVertical||(o>a&&(h=o-a),o>l&&(h=h?(h+l-o)/2:l-o)),(c||h||i)&&(u.x+=c,u.y+=h,u.width>1&&(u.x=.5-u.width/2),u.height>this.contentAspectY&&(u.y=this.contentAspectY/2-u.height/2)),this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i}),u},applyConstraints:function(e){var t,i,n=this.getZoom(),o=Math.max(Math.min(n,this.getMaxZoom()),this.getMinZoom());return n!=o&&this.zoomTo(o,this.zoomPoint,e),t=this.getBounds(),i=this._applyBoundaryConstraints(t,e),(t.x!==i.x||t.y!==i.y||e)&&this.fitBounds(i,e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,i){i=i||{};var n,o,r,s,a,l,c=i.immediately||!1,h=i.constraints||!1,u=this.getAspectRatio(),d=t.getCenter(),p=new e.Rect(t.x,t.y,t.width,t.height);return p.getAspectRatio()>=u?(p.height=t.width/u,p.y=d.y-p.height/2):(p.width=t.height*u,p.x=d.x-p.width/2),h&&(a=p.getAspectRatio()),this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),n=this.getBounds(),o=this.getZoom(),r=1/p.width,h&&(l=Math.max(Math.min(r,this.getMaxZoom()),this.getMinZoom()),r!==l&&(r=l,p.width=1/r,p.x=d.x-p.width/2,p.height=p.width/a,p.y=d.y-p.height/2),p=this._applyBoundaryConstraints(p,c)),r==o||p.width==n.width?this.panTo(h?p.getCenter():d,c):(s=n.getTopLeft().times(this.containerSize.x/n.width).minus(p.getTopLeft().times(this.containerSize.x/p.width)).divide(this.containerSize.x/n.width-this.containerSize.x/p.width),this.zoomTo(r,s,c))},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(1+t.x%1)%1,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(this.contentAspectY+t.y%this.contentAspectY)%this.contentAspectY,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitHeightBounds,e)},fitHorizontally:function(e){var t=this.getCenter();return this.wrapHorizontal&&(t.x=(this.contentAspectX+t.x%this.contentAspectX)%this.contentAspectX,this.centerSpringX.resetTo(t.x),this.centerSpringX.update()),this.wrapVertical&&(t.y=(1+t.y%1)%1,this.centerSpringY.resetTo(t.y),this.centerSpringY.update()),this.fitBounds(this.fitWidthBounds,e)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t=t.rotate(-this.degrees,new e.Point(0,0)),this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(t,i,n){return i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)&&(i=i.rotate(-this.degrees,new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value))),this.zoomTo(this.zoomSpring.target.value*t,i,n)},zoomTo:function(t,i,n){return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this.zoomSpring.resetTo(t):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()?(e=(e+360)%360,this.degrees=e,this.viewer.forceRedraw(),null!==this.viewer&&this.viewer.raiseEvent("rotate",{degrees:e}),this):this},getRotation:function(){return this.degrees},resize:function(t,i){var n,o=this.getBounds(),r=o;return this.containerSize=new e.Point(t.x,t.y),i&&(n=t.x/this.containerSize.x,r.width=o.width*n,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(r,!0)},update:function(){var e,t,i,n,o=this.centerSpringX.current.value,r=this.centerSpringY.current.value,s=this.zoomSpring.current.value;return this.zoomPoint&&(e=this.pixelFromPoint(this.zoomPoint,!0)),this.zoomSpring.update(),this.zoomPoint&&this.zoomSpring.current.value!=s?(t=this.pixelFromPoint(this.zoomPoint,!0),i=t.minus(e),n=this.deltaPointsFromPixels(i,!0),this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y)):this.zoomPoint=null,this.centerSpringX.update(),this.centerSpringY.update(),this.centerSpringX.current.value!=o||this.centerSpringY.current.value!=r||this.zoomSpring.current.value!=s},deltaPixelsFromPoints:function(e,t){return e.times(this.containerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return e.divide(this.containerSize.x*this.getZoom(t))},pixelFromPoint:function(e,t){var i=this.getBounds(t);return e.minus(i.getTopLeft()).times(this.containerSize.x/i.width)},pointFromPixel:function(e,t){var i=this.getBounds(t);return e.divide(this.containerSize.x/i.width).plus(i.getTopLeft())},viewportToImageCoordinates:function(t,i){return 1==arguments.length?this.viewportToImageCoordinates(t.x,t.y):new e.Point(t*this.contentSize.x,i*this.contentSize.y*this.contentAspectX)},imageToViewportCoordinates:function(t,i){return 1==arguments.length?this.imageToViewportCoordinates(t.x,t.y):new e.Point(t/this.contentSize.x,i/this.contentSize.y/this.contentAspectX)},imageToViewportRectangle:function(t,i,n,o){var r,s,a;return 1==arguments.length?(a=t,this.imageToViewportRectangle(a.x,a.y,a.width,a.height)):(r=this.imageToViewportCoordinates(t,i),s=this.imageToViewportCoordinates(n,o),new e.Rect(r.x,r.y,s.x,s.y))},viewportToImageRectangle:function(t,i,n,o){var r,s,a;return 1==arguments.length?(a=t,this.viewportToImageRectangle(a.x,a.y,a.width,a.height)):(r=this.viewportToImageCoordinates(t,i),s=this.viewportToImageCoordinates(n,o),new e.Rect(r.x,r.y,s.x,s.y))},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){var t=this.imageToViewerElementCoordinates(e);return t.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},windowToViewportCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(t)},viewportToWindowCoordinates:function(e){var t=this.viewportToViewerElementCoordinates(e);return t.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){var t=this.viewer.source.dimensions.x,i=this.getContainerSize().x,n=i/t;return e*n},imageToViewportZoom:function(e){var t=this.viewer.source.dimensions.x,i=this.getContainerSize().x,n=t/i;return e*n}}}(OpenSeadragon),function(){}.call(this);